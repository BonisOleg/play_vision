{% extends 'base/base.html' %}
{% load static %}
{% load subscription_tags %}

{% block title %}{{ meta_title }}{% endblock %}

{% block meta_description %}{{ meta_description }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/pricing.css' %}">
{% endblock %}

{% block content %}
<div class="pricing-page">
    <div class="container">
        
        <!-- Header -->
        <header class="pricing-header">
            <h1 class="pricing-title">–¢–∞—Ä–∏—Ñ–∏ Play Vision</h1>
            <p class="pricing-subtitle">–¢–≤–æ—ó –∑–Ω–∞–Ω–Ω—è ‚Äî –≤ –æ–¥–Ω—ñ–π –ø—ñ–¥–ø–∏—Å—Ü—ñ</p>
        </header>

        <!-- Period Switcher -->
        <div class="period-switcher-wrapper">
            <p class="period-label">–û–±–∏—Ä–∞–π —Ç—Ä–∞—î–∫—Ç–æ—Ä—ñ—é —Å–≤–æ–≥–æ —Ä–æ–∑–≤–∏—Ç–∫—É –Ω–∞ –º—ñ—Å—è—Ü—å –∞–±–æ –∫–≤–∞—Ä—Ç–∞–ª</p>
            
            <!-- Desktop Tabs - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ shared tab component -->
            <div class="period-tabs tab-container desktop-switcher">
                <div class="tab-slider" data-period-slider></div>
                {% for period in periods %}
                <button 
                    class="tab-button {% if period.value == 'monthly' %}active{% endif %}" 
                    data-period-tab
                    data-period="{{ period.value }}">
                    {{ period.label }}
                </button>
                {% endfor %}
            </div>
            
            <!-- Mobile Dropdown -->
            <div class="period-dropdown mobile-dropdown">
                <select id="period-select" class="period-select">
                    {% for period in periods %}
                    <option value="{{ period.value }}" {% if period.value == 'monthly' %}selected{% endif %}>
                        {{ period.label }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Plans Grid -->
        <div class="plans-container">
            <div class="plans-grid" id="plans-grid">
                {% for plan in plans %}
                <div class="plan-card {% if plan.is_popular %}plan-card--popular{% endif %} {% if 'PRO' in plan.name.upper or 'A-VISION' in plan.name.upper or 'A VISION' in plan.name.upper %}plan-card--coming-soon{% endif %}" 
                     data-plan-id="{{ plan.id }}">
                    
                    <!-- Badge -->
                    {% if plan.badge_text %}
                    <div class="plan-badge" style="background-color: {{ plan.badge_color }};">
                        {{ plan.badge_text }}
                    </div>
                    {% endif %}

                    <!-- Coming Soon Overlay -->
                    {% if 'PRO' in plan.name.upper or 'A-VISION' in plan.name.upper or 'A VISION' in plan.name.upper %}
                    <div class="plan-card-overlay plan-card-overlay--coming-soon">
                        <div class="coming-soon-content">
                            <div class="coming-soon-icon">üöÄ</div>
                            <div class="coming-soon-text">Coming Soon</div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Card Content -->
                    <div class="plan-content">
                        <!-- Plan Name -->
                        <h3 class="plan-name">{{ plan.name }}</h3>

                        <!-- Features List -->
                        <ul class="plan-features">
                            {% for feature in plan.get_features %}
                            <li class="feature-item">
                                <span class="feature-number">{{ forloop.counter|stringformat:"02d" }}</span>
                                <span class="feature-text">{{ feature }}</span>
                            </li>
                            {% endfor %}
                        </ul>

                        <!-- Price Section -->
                        <div class="plan-price-section">
                            <!-- Monthly -->
                            <div class="price-block" data-period="monthly">
                                <div class="price-amount">
                                    <span class="price-value">{{ plan.base_price_uah|floatformat:0 }}</span>
                                    <span class="price-currency">{{ currency_symbol }}</span>
                                </div>
                            </div>

                            <!-- 3 Months -->
                            <div class="price-block" data-period="3_months" style="display: none;">
                                <div class="price-amount">
                                    <span class="price-value">{% calculate_plan_price plan "3_months" currency as price_3m %}{{ price_3m|floatformat:0 }}</span>
                                    <span class="price-currency">{{ currency_symbol }}</span>
                                </div>
                                {% if plan.discount_3_months > 0 %}
                                <div class="price-save">
                                    –ï–∫–æ–Ω–æ–º—ñ—è {{ plan.discount_3_months }}%
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Action Button -->
                        <div class="plan-action">
                            <!-- Monthly Button -->
                            <div class="action-wrapper" data-period="monthly">
                                {% if plan.available_monthly %}
                                    <a href="{{ plan.checkout_url }}?plan={{ plan.slug }}&period=monthly" 
                                       class="btn-purchase">
                                        –ü—Ä–∏–¥–±–∞—Ç–∏ {{ plan.name }}
                                    </a>
                                {% else %}
                                    <div class="unavailable-notice">
                                        {{ plan.unavailable_text }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- 3 Months Button -->
                            <div class="action-wrapper" data-period="3_months" style="display: none;">
                                {% if plan.available_3_months %}
                                    <a href="{{ plan.checkout_url }}?plan={{ plan.slug }}&period=3_months" 
                                       class="btn-purchase">
                                        –ü—Ä–∏–¥–±–∞—Ç–∏ {{ plan.name }}
                                    </a>
                                {% else %}
                                    <div class="unavailable-notice">
                                        {{ plan.unavailable_text }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="no-plans">
                    <p>–¢–∞—Ä–∏—Ñ–∏ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ñ</p>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/shared/tab-slider.js' %}"></script>
<script src="{% static 'js/pricing.js' %}"></script>
{% endblock %}

