{% extends 'base/base.html' %}
{% load static %}

{% block title %}Івенти - Play Vision{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/events.css' %}">
{% endblock %}

{% block content %}
<div class="events-container">
    <!-- Календар подій з фільтрами -->
    <section class="event-calendar">
        <div class="calendar-header">
            <div class="calendar-title-section">
                <h2 class="calendar-title">Календар подій</h2>
                <p class="calendar-subtitle">Переглядайте події за днями та фільтруйте за типом</p>
            </div>

            <!-- Фільтри календаря -->
            <div class="calendar-filters">
                <select name="event_type" class="filter-select">
                    <option value="all">Всі типи подій</option>
                    {% for type_value, type_display in event_types %}
                    <option value="{{ type_value }}" {% if request.GET.type == type_value %}selected{% endif %}>{{ type_display }}</option>
                    {% endfor %}
                </select>

                <select name="event_format" class="filter-select">
                    <option value="all">Всі формати</option>
                    <option value="online" {% if request.GET.format == 'online' %}selected{% endif %}>Тільки онлайн
                    </option>
                    <option value="offline" {% if request.GET.format == 'offline' %}selected{% endif %}>Тільки офлайн
                    </option>
                    <option value="hybrid" {% if request.GET.format == 'hybrid' %}selected{% endif %}>Гібридні</option>
                </select>

                <button data-action="reset-filters"
                    class="btn btn--outline btn--small {% if not request.GET.type and not request.GET.format %}is-hidden{% endif %}">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                    Скинути
                </button>
            </div>

            <!-- Навігація по датах -->
            <div class="calendar-navigation">
                <button data-action="prev-week" class="nav-btn">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M15 18l-6-6 6-6" />
                    </svg>
                </button>
                <span class="current-period"></span>
                <button data-action="next-week" class="nav-btn">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9 18l6-6-6-6" />
                    </svg>
                </button>
                <button data-action="go-today" class="btn btn--ghost btn--small">Сьогодні</button>
            </div>
        </div>

        <!-- Календар видалено - використовується список подій нижче -->
        <div class="calendar-notice">
            <p>Події представлені списком з фільтрами нижче</p>
        </div>
    </section>

    <!-- Фільтри та список подій -->
    <section class="events-section">
        <div class="events-header">
            <h1 class="page-title">Івенти</h1>
            <p class="page-subtitle">Всі доступні офлайн та онлайн події Play Vision</p>
        </div>

        <div class="events-content">
            <!-- Бокова панель з фільтрами -->
            <aside class="events-sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Найближчі події</h3>
                    <ul class="upcoming-events">
                        <!-- Dynamic events populated by JavaScript -->
                    </ul>
                </div>

                <!-- Enhanced Filters -->
                <form method="get" action="{% url 'events:event_list' %}" class="filters-form">

                    <!-- Search Filter -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Пошук подій</h3>
                        <div class="search-group">
                            <input type="text" name="search" placeholder="Назва події або спікер..."
                                value="{{ current_search }}" class="search-input">
                            <button type="submit" class="search-btn">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <circle cx="11" cy="11" r="8" />
                                    <path d="m21 21-4.35-4.35" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Event Type Filter -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Тип події</h3>
                        <div class="filter-group">
                            {% for type_value, type_display in event_types %}
                            <label class="filter-option">
                                <input type="checkbox" name="event_type" value="{{ type_value }}" {% if type_value in current_types %}checked{% endif %}>
                                <span class="filter-checkmark"></span>
                                <span class="filter-label">{{ type_display }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Format Filter -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Формат проведення</h3>
                        <div class="filter-group">
                            <label class="filter-option">
                                <input type="radio" name="format" value="all" {% if current_format == 'all' or not current_format %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Всі формати</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="format" value="online" {% if current_format == 'online' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Онлайн</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="format" value="offline" {% if current_format == 'offline' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Офлайн</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="format" value="hybrid" {% if current_format == 'hybrid' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Гібрид</span>
                            </label>
                        </div>
                    </div>

                    <!-- Date Range Filter -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Період</h3>
                        <div class="filter-group">
                            <label class="filter-option">
                                <input type="radio" name="date_range" value="all" {% if current_date_range == 'all' or not current_date_range %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Всі події</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="date_range" value="today" {% if current_date_range == 'today' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Сьогодні</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="date_range" value="week" {% if current_date_range == 'week' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Цей тиждень</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="date_range" value="month" {% if current_date_range == 'month' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Цей місяць</span>
                            </label>
                        </div>
                    </div>

                    <!-- Фільтр "Ціна" з radio buttons -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Ціна</h3>
                        <div class="filter-group">
                            <label class="filter-option">
                                <input type="radio" name="price" value="all" {% if not current_price or current_price == 'all' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Всі події</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="free" {% if current_price == 'free' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Безкоштовні</span>
                            </label>
                            <label class="filter-option">
                                <input type="radio" name="price" value="paid" {% if current_price == 'paid' %}checked{% endif %}>
                                <span class="filter-radio"></span>
                                <span class="filter-label">Платні</span>
                            </label>
                        </div>
                    </div>

                    <!-- Filter Actions -->
                    <div class="filter-actions">
                        <button type="submit" class="btn btn--primary btn--full">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                            </svg>
                            Застосувати фільтри
                        </button>

                        <a href="{% url 'events:event_list' %}" class="btn btn--outline btn--full">
                            Скинути всі
                        </a>
                    </div>

                    <!-- Active Filters Display -->
                    <div
                        class="active-filters {% if not current_search and not current_types and not current_format or current_format == 'all' %}is-hidden{% endif %}">
                        <h4 class="active-filters-title">Активні фільтри:</h4>
                        <div class="filter-tags">
                            {% if current_search %}
                            <span class="filter-tag">
                                Пошук: {{ current_search }}
                                <a href="{% url 'events:event_list' %}" class="filter-tag-close">×</a>
                            </span>
                            {% endif %}

                            {% for type_display in current_types_display %}
                            <span class="filter-tag">
                                {{ type_display }}
                                <button type="button">×</button>
                            </span>
                            {% endfor %}

                            {% if current_format and current_format != 'all' %}
                            <span class="filter-tag">
                                Формат: {{ current_format|capfirst }}
                                <button type="button">×</button>
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </aside>

            <!-- Список подій -->
            <div class="events-main">
                <div class="events-grid">
                    {% for event in events %}
                    <article class="event-item">
                        <a href="{% url 'events:event_detail' event.slug %}" class="event-link">
                            {% if event.thumbnail %}
                            <img src="{{ event.thumbnail.url }}" alt="{{ event.title }}" class="event-image">
                            {% else %}
                            <div class="event-image-placeholder">
                                <svg class="placeholder-icon" width="60" height="60" fill="currentColor">
                                    <use xlink:href="#icon-calendar"></use>
                                </svg>
                            </div>
                            {% endif %}

                            <div class="event-content">
                                <div class="event-meta">
                                    <span class="event-type">{{ event.get_event_type_display }}</span>
                                    <span class="event-date">{{ event.start_datetime|date:"d.m.Y H:i" }}</span>
                                </div>

                                <h3 class="event-title">{{ event.title }}</h3>
                                <p class="event-description">{{ event.short_description }}</p>

                                <div class="event-footer">
                                    <div class="event-info">
                                        {% if event.is_online %}
                                        <span class="event-location">
                                            <svg class="icon icon--small" width="16" height="16">
                                                <use xlink:href="#icon-globe"></use>
                                            </svg>
                                            Онлайн
                                        </span>
                                        {% else %}
                                        <span class="event-location">
                                            <svg class="icon icon--small" width="16" height="16">
                                                <use xlink:href="#icon-location"></use>
                                            </svg>
                                            {{ event.location }}
                                        </span>
                                        {% endif %}

                                        {% if event.is_free %}
                                        <span class="event-price event-price--free">Безкоштовно</span>
                                        {% else %}
                                        <span class="event-price">{{ event.price }} ₴</span>
                                        {% endif %}
                                    </div>

                                    <button class="btn btn--primary btn--small">Детальніше</button>
                                </div>
                            </div>
                        </a>
                    </article>
                    {% empty %}
                    <!-- Тестові картки подій -->
                    <article class="event-item">
                        <a href="{% url 'events:event_detail' 'forum-fff-5' %}" class="event-link">
                            <div class="event-image-placeholder">
                                <svg class="placeholder-icon" width="60" height="60" fill="currentColor">
                                    <use xlink:href="#icon-calendar"></use>
                                </svg>
                            </div>

                            <div class="event-content">
                                <div class="event-meta">
                                    <span class="event-type">Форум</span>
                                    <span class="event-date">08.09.2024 18:00</span>
                                </div>

                                <h3 class="event-title">Форум футбольних фахівців 5</h3>
                                <p class="event-description">Щорічна онлайн-подія для тренерів, аналітиків, менеджерів
                                    та психологів</p>

                                <div class="event-footer">
                                    <div class="event-info">
                                        <span class="event-location">
                                            <svg class="icon icon--small" width="16" height="16">
                                                <use xlink:href="#icon-globe"></use>
                                            </svg>
                                            Онлайн
                                        </span>
                                        <span class="event-price">1290 ₴</span>
                                    </div>

                                    <button class="btn btn--primary btn--small">Детальніше</button>
                                </div>
                            </div>
                        </a>
                    </article>

                    <article class="event-item">
                        <a href="{% url 'events:event_detail' 'masterclass-xg' %}" class="event-link">
                            <div class="event-image-placeholder">
                                <svg class="placeholder-icon" width="60" height="60" fill="currentColor">
                                    <use xlink:href="#icon-calendar"></use>
                                </svg>
                            </div>

                            <div class="event-content">
                                <div class="event-meta">
                                    <span class="event-type">Майстер-клас</span>
                                    <span class="event-date">09.09.2024 19:00</span>
                                </div>

                                <h3 class="event-title">Майстер-клас xG: аналіз очікуваних голів</h3>
                                <p class="event-description">Практичний майстер-клас з використання метрики xG в аналізі
                                    матчів</p>

                                <div class="event-footer">
                                    <div class="event-info">
                                        <span class="event-location">
                                            <svg class="icon icon--small" width="16" height="16">
                                                <use xlink:href="#icon-globe"></use>
                                            </svg>
                                            Онлайн
                                        </span>
                                        <span class="event-price">890 ₴</span>
                                    </div>

                                    <button class="btn btn--primary btn--small">Детальніше</button>
                                </div>
                            </div>
                        </a>
                    </article>

                    <article class="event-item">
                        <a href="{% url 'events:event_detail' 'roundtable-academies' %}" class="event-link">
                            <div class="event-image-placeholder">
                                <svg class="placeholder-icon" width="60" height="60" fill="currentColor">
                                    <use xlink:href="#icon-calendar"></use>
                                </svg>
                            </div>

                            <div class="event-content">
                                <div class="event-meta">
                                    <span class="event-type">Семінар</span>
                                    <span class="event-date">10.09.2024 17:00</span>
                                </div>

                                <h3 class="event-title">Круглий стіл: Розвиток академій в Україні</h3>
                                <p class="event-description">Обговорення актуальних питань розвитку футбольних академій
                                </p>

                                <div class="event-footer">
                                    <div class="event-info">
                                        <span class="event-location">
                                            <svg class="icon icon--small" width="16" height="16">
                                                <use xlink:href="#icon-globe"></use>
                                            </svg>
                                            Онлайн
                                        </span>
                                        <span class="event-price event-price--free">Безкоштовно</span>
                                    </div>

                                    <button class="btn btn--primary btn--small">Детальніше</button>
                                </div>
                            </div>
                        </a>
                    </article>

                    <article class="event-item">
                        <a href="{% url 'events:event_detail' 'internship-dynamo' %}" class="event-link">
                            <div class="event-image-placeholder">
                                <svg class="placeholder-icon" width="60" height="60" fill="currentColor">
                                    <use xlink:href="#icon-calendar"></use>
                                </svg>
                            </div>

                            <div class="event-content">
                                <div class="event-meta">
                                    <span class="event-type">Стажування</span>
                                    <span class="event-date">15.09.2024 10:00</span>
                                </div>

                                <h3 class="event-title">Стажування у ФК "Динамо" Київ</h3>
                                <p class="event-description">Практичне стажування в академії провідного клубу України
                                </p>

                                <div class="event-footer">
                                    <div class="event-info">
                                        <span class="event-location">
                                            <svg class="icon icon--small" width="16" height="16">
                                                <use xlink:href="#icon-location"></use>
                                            </svg>
                                            м. Київ
                                        </span>
                                        <span class="event-price">3500 ₴</span>
                                    </div>

                                    <button class="btn btn--primary btn--small">Детальніше</button>
                                </div>
                            </div>
                        </a>
                    </article>
                    {% endfor %}
                </div>

                <!-- Пагінація -->
                {% if is_paginated %}
                <nav class="pagination">
                    {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="pagination-link pagination-link--prev">
                        <svg class="icon" width="20" height="20">
                            <use xlink:href="#icon-arrow-left"></use>
                        </svg>
                        Попередня
                    </a>
                    {% endif %}

                    <div class="pagination-numbers">
                        {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <span class="pagination-current">{{ num }}</span>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}<a
                            href="?page={{ num }}" class="pagination-link">{{ num }}</a>
                            {% endif %}
                            {% endfor %}
                    </div>

                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="pagination-link pagination-link--next">
                        Наступна
                        <svg class="icon" width="20" height="20">
                            <use xlink:href="#icon-arrow-right"></use>
                        </svg>
                    </a>
                    {% endif %}
                </nav>
                {% endif %}
            </div>
        </div>
    </section>
</div>

<!-- SVG спрайт для іконок -->
<svg class="svg-sprites-hidden">
    <symbol id="icon-calendar" viewBox="0 0 24 24">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2" />
        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" />
        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" />
        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="icon-globe" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" />
        <line x1="2" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="2" />
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" fill="none"
            stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="icon-location" viewBox="0 0 24 24">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" fill="none" stroke="currentColor" stroke-width="2" />
        <circle cx="12" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="icon-calendar-empty" viewBox="0 0 24 24">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="2"
            stroke-dasharray="3 3" />
        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" />
        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" />
        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="icon-arrow-left" viewBox="0 0 24 24">
        <line x1="19" y1="12" x2="5" y2="12" stroke="currentColor" stroke-width="2" />
        <polyline points="12 19 5 12 12 5" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
    <symbol id="icon-arrow-right" viewBox="0 0 24 24">
        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" />
        <polyline points="12 5 19 12 12 19" fill="none" stroke="currentColor" stroke-width="2" />
    </symbol>
</svg>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/events.js' %}"></script>
{% endblock %}