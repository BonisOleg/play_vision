{% extends 'base/base.html' %}
{% load static %}

{% block title %}Кабінет користувача - Play Vision{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/cabinet.css' %}">
<link rel="stylesheet" href="{% static 'css/components/cabinet-additions.css' %}">
{% endblock %}

{% block content %}
<div class="cabinet-wrapper">
    <div class="cabinet-container">
        <!-- Ліва частина: профіль та форма -->
        <div class="cabinet-left">
            <div class="profile-section">
                <!-- Аватар -->
                <div class="profile-avatar">
                    {% if user_profile and user_profile.avatar %}
                    <img src="{{ user_profile.avatar.url }}" alt="Аватар" class="avatar-img">
                    {% else %}
                    <div class="avatar-placeholder">
                        {{ user.first_name|first|default:user.email|first|upper }}
                    </div>
                    {% endif %}
                    <button class="avatar-upload-btn">
                        Завантажити фото
                    </button>
                    <input type="file" id="avatar-input" accept="image/*" class="is-hidden">
                </div>

                <!-- Форма профілю -->
                <form class="profile-form" id="profile-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="first_name">ПІБ</label>
                        <input type="text" id="first_name" name="first_name" class="form-control"
                            placeholder="Ім'я Прізвище"
                            value="{{ user_profile.first_name|default:'' }} {{ user_profile.last_name|default:'' }}">
                    </div>

                    <div class="form-group">
                        <label for="birth_date">Дата народження</label>
                        <input type="date" id="birth_date" name="birth_date" class="form-control"
                            value="{{ user_profile.birth_date|date:'Y-m-d'|default:'' }}">
                    </div>

                    <div class="form-group">
                        <label for="profession">Професія/спеціальність</label>
                        <input type="text" id="profession" name="profession" class="form-control"
                            placeholder="Тренер / Аналітик / Психолог" value="{{ user_profile.profession|default:'' }}">
                        <span class="profession-badge">Sports Knowledge Shop</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">E-mail</label>
                            <input type="email" id="email" name="email" class="form-control" value="{{ user.email }}">
                            <span class="verification-badge verified">верифіковано</span>
                        </div>
                        <div class="form-group">
                            <label for="phone">Телефон</label>
                            <input type="tel" id="phone" name="phone" class="form-control" placeholder="+380..."
                                value="{{ user.phone|default:'' }}">
                            <span class="verification-badge">очікує</span>
                        </div>
                    </div>

                    <div class="password-section">
                        <div class="form-group">
                            <label for="new_password">Новий пароль</label>
                            <input type="password" id="new_password" name="new_password" class="form-control"
                                placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label for="confirm_password">Підтвердити пароль</label>
                            <input type="password" id="confirm_password" name="confirm_password" class="form-control"
                                placeholder="••••••••">
                        </div>
                    </div>

                    <div class="interests-section">
                        <label>Напрямки (інтереси)</label>
                        <div class="interests-list">
                            {% for interest in interests %}
                            <label class="interest-item">
                                <input type="checkbox" name="interests" value="{{ interest.id }}" {% if interest in user.profile.interests.all %}checked{% endif %}>
                                <span class="interest-label">
                                    <span class="interest-number">{{ forloop.counter }}.</span>
                                    {{ interest.name }}
                                </span>
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    <button type="submit" class="btn-save">ЗБЕРЕГТИ</button>
                </form>
            </div>
        </div>

        <!-- Права частина: вкладки та контент -->
        <div class="cabinet-right">
            <!-- Навігація по вкладках -->
            <nav class="cabinet-tabs">
                <a href="{% url 'cabinet:profile' %}"
                    class="tab-link {% if active_tab == 'profile' %}active{% endif %}">
                    Профіль
                </a>
                <a href="{% url 'cabinet:subscription' %}"
                    class="tab-link {% if active_tab == 'subscription' %}active{% endif %}">
                    Підписка
                </a>
                <a href="{% url 'cabinet:files' %}" class="tab-link {% if active_tab == 'files' %}active{% endif %}">
                    Мої файли
                </a>
                <a href="{% url 'cabinet:loyalty' %}"
                    class="tab-link {% if active_tab == 'loyalty' %}active{% endif %}">
                    Програма лояльності
                </a>
                <a href="{% url 'cabinet:payments' %}"
                    class="tab-link {% if active_tab == 'payments' %}active{% endif %}">
                    Історія оплат
                </a>
            </nav>

            <!-- Контент вкладок -->
            <div class="tab-content">
                {% if active_tab == 'profile' %}
                {% include 'account/tabs/profile.html' %}
                {% elif active_tab == 'subscription' %}
                {% include 'account/tabs/subscription.html' %}
                {% elif active_tab == 'files' %}
                {% include 'account/tabs/files.html' %}
                {% elif active_tab == 'loyalty' %}
                {% include 'account/tabs/loyalty.html' %}
                {% elif active_tab == 'payments' %}
                {% include 'account/tabs/payments.html' %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Фіксована кнопка зв'язку/чату -->
    <div class="support-button">
        <button class="support-btn">
            Зв'язок / Бот
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/cabinet.js' %}"></script>
{% endblock %}