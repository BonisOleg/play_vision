<!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ -->
<div class="loyalty-tab">
    <div class="loyalty-cards">
        <!-- –ü–æ—Ç–æ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å -->
        <div class="info-card">
            <h3>–†—ñ–≤–µ–Ω—å</h3>
            <div class="tier-info">
                {% if current_tier %}
                <div class="tier-name tier-{{ current_tier.name|lower }}">
                    {{ current_tier.name }}
                </div>
                <div class="tier-points">
                    {{ loyalty_account.points }} –±–∞–ª—ñ–≤
                </div>
                {% else %}
                <div class="tier-name tier-bronze">
                    Bronze
                </div>
                <div class="tier-points">
                    0 –±–∞–ª—ñ–≤
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å —Ä—ñ–≤–Ω—è -->
        <div class="info-card">
            <h3>–ü—Ä–æ–≥—Ä–µ—Å —Ä—ñ–≤–Ω—è</h3>
            {% if next_tier %}
            <div class="progress-info">
                <div class="progress-text">
                    {{ loyalty_account.points }}/{{ next_tier.points_required }} –±–∞–ª—ñ–≤ –¥–æ {{ next_tier.name }}
                </div>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" data-progress="{{ progress_percentage }}"></div>
                    </div>
                </div>
                <div class="progress-remaining">
                    {% if points_needed > 0 %}
                    –ü–æ—Ç—Ä—ñ–±–Ω–æ —â–µ {{ points_needed }} –±–∞–ª—ñ–≤
                    {% else %}
                    –ì–æ—Ç–æ–≤–æ –¥–æ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è!
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="progress-info">
                <div class="progress-text max-tier">
                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—è–≥–Ω—É—Ç–æ
                </div>
            </div>
            {% endif %}
        </div>

        <!-- –ó–Ω–∏–∂–∫–∞ -->
        <div class="info-card">
            <h3>–ó–Ω–∏–∂–∫–∞</h3>
            <div class="discount-info">
                <div class="current-discount">
                    <span class="discount-label">–ü–æ—Ç–æ—á–Ω–∞:</span>
                    <span class="discount-value">{{ discounts.current }}%</span>
                </div>
                {% if discounts.potential > discounts.current %}
                <div class="potential-discount">
                    <span class="discount-label">–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞:</span>
                    <span class="discount-value">{{ discounts.potential }}%</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –†—ñ–≤–Ω—ñ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ -->
    <div class="loyalty-tiers">
        <h3>–†—ñ–≤–Ω—ñ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ</h3>
        <div class="tiers-list">
            {% for tier in all_tiers %}
            <div class="tier-item {% if current_tier and tier.id == current_tier.id %}current{% endif %}">
                <div class="tier-badge tier-{{ tier.name|lower }}">
                    {{ tier.name }}
                </div>
                <div class="tier-details">
                    <div class="tier-requirements">
                        {% if tier.points_required == 0 %}
                        –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å
                        {% else %}
                        {{ tier.points_required }}+ –±–∞–ª—ñ–≤
                        {% endif %}
                    </div>
                    <div class="tier-benefits">
                        <span class="benefit">–ó–Ω–∏–∂–∫–∞ {{ tier.discount_percentage }}%</span>
                        {% for benefit in tier.benefits %}
                        <span class="benefit">{{ benefit }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% if current_tier and tier.id == current_tier.id %}
                <div class="tier-status current">–ü–æ—Ç–æ—á–Ω–∏–π</div>
                {% elif tier.points_required <= loyalty_account.points %} <div class="tier-status achieved">–î–æ—Å—è–≥–Ω—É—Ç–æ
            </div>
            {% else %}
            <div class="tier-status locked">–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Loyalty Rules Link -->
<div class="loyalty-info-card">
    <div class="info-card-content">
        <h3>–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
        <p>–û–∑–Ω–∞–π–æ–º—Ç–µ—Å—è –∑ –ø–æ–≤–Ω–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ç–∞ —É–º–æ–≤–∞–º–∏ –ü—Ä–æ–≥—Ä–∞–º–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ</p>
        <a href="{% url 'loyalty:rules' %}" class="btn btn-outline btn-large">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" />
            </svg>
            –ü—Ä–∞–≤–∏–ª–∞ –ü—Ä–æ–≥—Ä–∞–º–∏ –õ–æ—è–ª—å–Ω–æ—Å—Ç—ñ
        </a>
    </div>
</div>

<!-- –Ø–∫ –∑–∞—Ä–æ–±–ª—è—Ç–∏ –±–∞–ª–∏ -->
<div class="earning-ways">
    <h3>–Ø–∫ –∑–∞—Ä–æ–±–ª—è—Ç–∏ –±–∞–ª–∏</h3>
    <div class="ways-grid">
        <div class="way-item">
            <div class="way-icon">üõí</div>
            <h4>–ü–æ–∫—É–ø–∫–∏</h4>
            <p>1 –±–∞–ª –∑–∞ –∫–æ–∂–Ω—É $1 –≤–∏—Ç—Ä–∞—á–µ–Ω—É</p>
        </div>
        <div class="way-item">
            <div class="way-icon">üìù</div>
            <h4>–ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</h4>
            <p>50 –±–∞–ª—ñ–≤ –∑–∞ –ø–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å</p>
        </div>
        <div class="way-item">
            <div class="way-icon">üéì</div>
            <h4>–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤</h4>
            <p>10-30 –±–∞–ª—ñ–≤ –∑–∞ –∫—É—Ä—Å</p>
        </div>
        <div class="way-item">
            <div class="way-icon">üìÖ</div>
            <h4>–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è —ñ–≤–µ–Ω—Ç—ñ–≤</h4>
            <p>20 –±–∞–ª—ñ–≤ –∑–∞ –∫–æ–∂–Ω–∏–π —ñ–≤–µ–Ω—Ç</p>
        </div>
    </div>
</div>

<!-- –Ü—Å—Ç–æ—Ä—ñ—è –±–∞–ª—ñ–≤ -->
{% if recent_transactions %}
<div class="points-history">
    <h3>–û—Å—Ç–∞–Ω–Ω—ñ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è</h3>
    <div class="transactions-list">
        {% for transaction in recent_transactions %}
        <div class="transaction-item">
            <div class="transaction-info">
                <div class="transaction-reason">{{ transaction.reason }}</div>
                <div class="transaction-date">{{ transaction.created_at|date:"d.m.Y H:i" }}</div>
            </div>
            <div class="transaction-points {% if transaction.points > 0 %}positive{% else %}negative{% endif %}">
                {% if transaction.points > 0 %}+{% endif %}{{ transaction.points }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- –¢–µ—Å—Ç–æ–≤—ñ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ -->
<div class="info-card">
    <h3>–¢–µ—Å—Ç–æ–≤—ñ –¥—ñ—ó</h3>
    <div class="test-actions">
        <button class="btn-primary" data-action="addLoyaltyPoints" data-points="50" data-reason="–¢–µ—Å—Ç–æ–≤–µ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è">
            –î–æ–¥–∞—Ç–∏ 50 –±–∞–ª—ñ–≤
        </button>
        <button class="btn-secondary" data-action="addLoyaltyPoints" data-points="100" data-reason="–í–µ–ª–∏–∫–∏–π –±–æ–Ω—É—Å">
            –î–æ–¥–∞—Ç–∏ 100 –±–∞–ª—ñ–≤
        </button>
        <button class="btn-secondary" data-action="addLoyaltyPoints" data-points="200" data-reason="–ú–µ–≥–∞ –±–æ–Ω—É—Å">
            –î–æ–¥–∞—Ç–∏ 200 –±–∞–ª—ñ–≤
        </button>
    </div>
    <p class="test-note">
        <small>–¶—ñ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–∞–ª—ñ–≤ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ</small>
    </p>
</div>
</div>