{% extends 'base/base.html' %}
{% load static %}

{% block title %}–î–∞—à–±–æ—Ä–¥ - Play Vision{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/account.css' %}">
<link rel="stylesheet" href="{% static 'css/components/development.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="account-layout">
        <!-- Sidebar Navigation -->
        <nav class="account-sidebar">
            <div class="account-user-info">
                <div class="user-avatar">
                    {% if user.profile.avatar %}
                    <img src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
                    {% else %}
                    <div class="avatar-placeholder">{{ user.first_name|first|default:user.email|first }}</div>
                    {% endif %}
                </div>
                <div class="user-details">
                    <h3>{{ user.profile.full_name|default:user.email }}</h3>
                    {% if active_subscription %}
                    <span class="subscription-badge">{{ active_subscription.plan.name }}</span>
                    {% else %}
                    <span class="subscription-badge free">–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π</span>
                    {% endif %}
                </div>
            </div>

            <ul class="account-nav">
                <li><a href="{% url 'cabinet:dashboard' %}" class="active">üìä –î–∞—à–±–æ—Ä–¥</a></li>
                <li><a href="{% url 'cabinet:profile' %}">üë§ –ü—Ä–æ—Ñ—ñ–ª—å</a></li>
                <li><a href="{% url 'cabinet:subscription' %}">üíé –ü—ñ–¥–ø–∏—Å–∫–∞</a></li>
                <li><a href="{% url 'cabinet:files' %}">üìÅ –ú–æ—ó —Ñ–∞–π–ª–∏</a></li>
                <li><a href="{% url 'cabinet:courses' %}">üéì –ú–æ—ó –∫—É—Ä—Å–∏</a></li>
                <li><a href="{% url 'cabinet:events' %}">üé™ –ú–æ—ó —ñ–≤–µ–Ω—Ç–∏</a></li>
                <li><a href="{% url 'cabinet:payments' %}">üí≥ –ü–ª–∞—Ç–µ–∂—ñ</a></li>
                <li><a href="{% url 'cabinet:loyalty' %}">‚≠ê –õ–æ—è–ª—å–Ω—ñ—Å—Ç—å</a></li>
                <li><a href="{% url 'cabinet:settings' %}">‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="account-main">
            <div class="account-header">
                <h1>–î–∞—à–±–æ—Ä–¥</h1>
                {% if under_development %}
                <div class="development-notice">
                    <p>üöß –†–æ–∑–¥—ñ–ª –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ</p>
                    <p>–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º</p>
                </div>
                {% endif %}
            </div>

            <!-- Profile Completion Alert -->
            {% if not profile_complete %}
            <div class="completion-alert">
                <h3>üéØ –ó–∞–≤–µ—Ä—à—ñ—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é</h3>
                <p>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø—Ä–æ—Ñ—ñ–ª—å –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π —Ç–∞ –±–æ–Ω—É—Å—ñ–≤</p>
                <a href="{% url 'cabinet:profile_edit' %}" class="btn btn-primary">–ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å</a>
            </div>
            {% endif %}

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üéì</div>
                    <div class="stat-content">
                        <h3>{{ stats.total_courses }}</h3>
                        <p>–í—Å—å–æ–≥–æ –∫—É—Ä—Å—ñ–≤</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <h3>{{ stats.completed_courses }}</h3>
                        <p>–ó–∞–≤–µ—Ä—à–µ–Ω–æ –∫—É—Ä—Å—ñ–≤</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üé™</div>
                    <div class="stat-content">
                        <h3>{{ stats.upcoming_events }}</h3>
                        <p>Upcoming —ñ–≤–µ–Ω—Ç–∏</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üí≥</div>
                    <div class="stat-content">
                        <h3>{{ stats.total_payments }}</h3>
                        <p>–£—Å–ø—ñ—à–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂—ñ–≤</p>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Content -->
            <div class="dashboard-grid">
                <!-- Recent Courses -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>–û—Å—Ç–∞–Ω–Ω—ñ –∫—É—Ä—Å–∏</h3>
                        <a href="{% url 'cabinet:courses' %}">–í—Å—ñ –∫—É—Ä—Å–∏ ‚Üí</a>
                    </div>
                    <div class="card-content">
                        {% if recent_courses %}
                        {% for progress in recent_courses %}
                        <div class="course-item">
                            <div class="course-info">
                                <h4>{{ progress.course.title }}</h4>
                                <p>–ü—Ä–æ–≥—Ä–µ—Å: {{ progress.progress_percentage|floatformat:0 }}%</p>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="{{ progress.progress_percentage }}"></div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p class="no-content">–ö—É—Ä—Å–∏ —â–µ –Ω–µ —Ä–æ–∑–ø–æ—á–∞—Ç–æ</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Subscription Info -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>–ú–æ—è –ø—ñ–¥–ø–∏—Å–∫–∞</h3>
                        <a href="{% url 'cabinet:subscription' %}">–ö–µ—Ä—É–≤–∞—Ç–∏ ‚Üí</a>
                    </div>
                    <div class="card-content">
                        {% if active_subscription %}
                        <div class="subscription-info">
                            <h4>{{ active_subscription.plan.name }}</h4>
                            <p>–î—ñ—î –¥–æ: {{ active_subscription.end_date|date:"d.m.Y" }}</p>
                            <div class="features">
                                {% for feature in active_subscription.plan.features %}
                                <span class="feature-tag">{{ feature }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% else %}
                        <div class="no-subscription">
                            <p>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏</p>
                            <a href="{% url 'core:pricing' %}" class="btn btn-primary">–û—Ñ–æ—Ä–º–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫—É</a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Upcoming Events -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h3>–ù–∞–π–±–ª–∏–∂—á—ñ —ñ–≤–µ–Ω—Ç–∏</h3>
                        <a href="{% url 'cabinet:events' %}">–í—Å—ñ —ñ–≤–µ–Ω—Ç–∏ ‚Üí</a>
                    </div>
                    <div class="card-content">
                        {% if upcoming_events %}
                        {% for ticket in upcoming_events %}
                        <div class="event-item">
                            <div class="event-date">
                                <span class="day">{{ ticket.event.start_datetime|date:"d" }}</span>
                                <span class="month">{{ ticket.event.start_datetime|date:"M" }}</span>
                            </div>
                            <div class="event-info">
                                <h4>{{ ticket.event.title }}</h4>
                                <p>{{ ticket.event.start_datetime|date:"H:i" }}</p>
                                <span class="status-{{ ticket.status }}">{{ ticket.get_status_display }}</span>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p class="no-content">–ù–µ–º–∞—î –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö —ñ–≤–µ–Ω—Ç—ñ–≤</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/pages/account.js' %}"></script>
{% endblock %}