{% load static %}
{% load hub_tags %}

<!-- Grid продуктів -->
<div class="hub-catalog-grid">
    {% if courses %}
    {% for course in courses %}
    <article class="hub-product-card">
        <div class="hub-product-header">
            <h3 class="hub-product-title">{{ course.title }}</h3>
            <button type="button" class="hub-favorite-icon" data-course-id="{{ course.id }}" {% if course.id in user_favorites %}data-favorited="true"{% endif %} aria-label="Додати до улюблених">
                <svg class="icon-heart" width="18" height="18" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
            </button>
        </div>
        <div class="hub-product-image">
            <!-- Бейджі -->
            {% if course.has_discount or course.is_top_seller or course.is_coming_soon or course.is_new %}
            <div class="hub-product-badges">
                {% if course.has_discount and course.discount_percent > 0 %}
                <span class="hub-badge hub-badge-discount">
                    Знижка -{{ course.discount_percent }}%
                </span>
                {% endif %}
                
                {% if course.is_top_seller %}
                <span class="hub-badge hub-badge-top">
                    Топ продажів
                </span>
                {% endif %}
                
                {% if course.is_coming_soon %}
                <span class="hub-badge hub-badge-coming-soon">
                    Незабаром
                </span>
                {% endif %}
                
                {% if course.is_new %}
                <span class="hub-badge hub-badge-new">
                    Новинка
                </span>
                {% endif %}
            </div>
            {% endif %}
            
            {% if course.thumbnail %}
            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" loading="lazy">
            {% else %}
            <img src="{% static 'images/placeholder-1200x600.svg' %}"
                alt="{{ course.title }}" loading="lazy">
            {% endif %}
        </div>
        <div class="hub-product-body">
            {% if course.has_discount and course.discount_percent > 0 %}
            <!-- Ціна зі знижкою -->
            <div class="hub-product-price has-discount">
                <div class="hub-price-old">
                    Стара ціна: {{ course.price|floatformat:0 }}₴
                </div>
                <div class="hub-price-new">
                    <span class="price-label">Ціна:</span>
                    <span class="price-value">{{ course.get_discounted_price|floatformat:0 }}₴</span>
                </div>
            </div>
            {% else %}
            <!-- Звичайна ціна -->
            <div class="hub-product-price">
                <span class="price-label">Ціна:</span>
                <span class="price-value">{{ course.price|floatformat:0 }}₴</span>
            </div>
            {% endif %}
            <p class="hub-product-desc">{{ course.short_description }}</p>

            {% if course.target_audience %}
            <div class="hub-product-audience">
                Кому підходить: 
                {% for aud in course.get_target_audience_display %}
                    {{ aud }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            <a href="{{ course.get_absolute_url }}" class="hub-btn-view">
                <span class="btn-text">Огляд</span>
                <span class="btn-logo-space"></span>
            </a>

            {% if course.requires_subscription %}
                {% if course.subscription_tiers and course.subscription_tiers|length > 0 %}
                <div class="hub-product-divider"></div>
                <div class="hub-product-subscription">
                    Краще з підпискою:
                    {% for tier in course.subscription_tiers %}
                    {{ tier|upper }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </div>
                {% else %}
                <div class="hub-product-divider"></div>
                <div class="hub-product-subscription">
                    Доступно з підпискою: C-VISION, B-VISION, A-VISION, PRO-VISION
                </div>
                {% endif %}
            {% elif course.subscription_text %}
            <div class="hub-product-divider"></div>
            <div class="hub-product-subscription">
                {{ course.subscription_text }}
            </div>
            {% endif %}
        </div>
    </article>
    {% endfor %}
    {% else %}
    <div class="hub-no-products">
        <p>Курсів не знайдено</p>
        <a href="{% url 'content:course_list' %}" class="btn btn-primary">Показати всі</a>
    </div>
    {% endif %}
</div>

<!-- Пагінація -->
{% if is_paginated %}
<div class="pagination-wrapper">
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="#" 
           class="pagination-link pagination-link--prev"
           hx-get="{% pagination_url 1 %}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            ‹‹ Перша
        </a>
        <a href="#" 
           class="pagination-link"
           hx-get="{% pagination_url page_obj.previous_page_number %}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            ‹
        </a>
        {% endif %}

        <div class="pagination-numbers">
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="pagination-current">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="#" 
               class="pagination-link"
               hx-get="{% pagination_url num %}"
               hx-target="#catalog-content"
               hx-swap="innerHTML"
               hx-push-url="true">{{ num }}</a>
            {% endif %}
            {% endfor %}
        </div>

        {% if page_obj.has_next %}
        <a href="#" 
           class="pagination-link"
           hx-get="{% pagination_url page_obj.next_page_number %}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            ›
        </a>
        <a href="#" 
           class="pagination-link pagination-link--next"
           hx-get="{% pagination_url page_obj.paginator.num_pages %}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            Остання ››
        </a>
        {% endif %}
    </div>
</div>
{% endif %}

