{% load static %}

<!-- Grid продуктів -->
<div class="hub-catalog-grid">
    {% if courses %}
    {% for course in courses %}
    <article class="hub-product-card">
        <div class="hub-product-header">
            <h3 class="hub-product-title">{{ course.title }}</h3>
            <button type="button" class="hub-favorite-icon" data-course-id="{{ course.id }}" {% if course.id in user_favorites %}data-favorited="true"{% endif %} aria-label="Додати до улюблених">
                <svg class="icon-heart" width="18" height="18" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
            </button>
        </div>
        <div class="hub-product-image">
            {% if course.thumbnail %}
            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" loading="lazy">
            {% else %}
            <img src="{% static 'images/placeholder-1200x600.svg' %}"
                alt="{{ course.title }}" loading="lazy">
            {% endif %}
        </div>
        <div class="hub-product-body">
            <div class="hub-product-price">
                <span class="price-label">Ціна:</span>
                <span class="price-value">{{ course.price|floatformat:0 }}₴</span>
            </div>
            <p class="hub-product-desc">{{ course.short_description }}</p>

            {% if course.target_audience %}
            <div class="hub-product-audience">
                Кому підходить: 
                {% for aud in course.get_target_audience_display %}
                    {{ aud }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            <a href="{{ course.get_absolute_url }}" class="hub-btn-view">
                <span class="btn-text">Огляд курсу</span>
                <span class="btn-logo-space"></span>
            </a>

            {% if course.subscription_tiers and course.subscription_tiers|length > 0 %}
            <div class="hub-product-divider"></div>
            <div class="hub-product-subscription">
                Краще з підпискою:
                {% for tier in course.subscription_tiers %}
                {{ tier|upper }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
            {% elif course.requires_subscription %}
            <div class="hub-product-divider"></div>
            <div class="hub-product-subscription">
                Доступно з підпискою: C-VISION, B-VISION, A-VISION, PRO-VISION
            </div>
            {% endif %}
        </div>
    </article>
    {% endfor %}
    {% else %}
    <div class="hub-no-products">
        <p>Курсів не знайдено</p>
        <a href="{% url 'content:course_list' %}" class="btn btn-primary">Показати всі</a>
    </div>
    {% endif %}
</div>

<!-- Пагінація -->
{% if is_paginated %}
<div class="pagination-wrapper">
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page=1" 
           class="pagination-link pagination-link--prev"
           hx-get="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page=1"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            ‹‹ Перша
        </a>
        <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}" 
           class="pagination-link"
           hx-get="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.previous_page_number }}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            ‹
        </a>
        {% endif %}

        <div class="pagination-numbers">
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="pagination-current">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}" 
               class="pagination-link"
               hx-get="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}"
               hx-target="#catalog-content"
               hx-swap="innerHTML"
               hx-push-url="true">{{ num }}</a>
            {% endif %}
            {% endfor %}
        </div>

        {% if page_obj.has_next %}
        <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}" 
           class="pagination-link"
           hx-get="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.next_page_number }}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            ›
        </a>
        <a href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.paginator.num_pages }}" 
           class="pagination-link pagination-link--next"
           hx-get="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ page_obj.paginator.num_pages }}"
           hx-target="#catalog-content"
           hx-swap="innerHTML"
           hx-push-url="true">
            Остання ››
        </a>
        {% endif %}
    </div>
</div>
{% endif %}

