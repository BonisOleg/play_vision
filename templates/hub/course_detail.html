{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Play Vision{% endblock %}
{% block meta_description %}{{ course.short_description }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/section-base.css' %}">
<link rel="stylesheet" href="{% static 'css/components/unified-sections.css' %}">
<link rel="stylesheet" href="{% static 'css/components/course-detail-unified.css' %}">
{% endblock %}

{% block content %}
<div class="fullscreen-container">
    <div class="unified-sections-wrapper">
        <div class="unified-sections-container">
            
            <!-- HERO SECTION -->
            <section class="fullscreen-section course-detail-hero">
                <div class="section-content">
                    <div class="course-hero-grid">
                        
                        <!-- Left: Info Block -->
                        <div class="course-info-block">
                            <nav class="breadcrumb">
                                <a href="{% url 'content:course_list' %}">Хаб знань</a>
                                <span>/</span>
                                <span>{{ course.title }}</span>
                            </nav>
                            
                            {% if course.has_discount or course.is_top_seller or course.is_coming_soon or course.is_new %}
                            <div class="course-badges">
                                {% if course.has_discount and course.discount_percent > 0 %}
                                <span class="hub-badge hub-badge-discount">
                                    Знижка -{{ course.discount_percent }}%
                                </span>
                                {% endif %}
                                
                                {% if course.is_top_seller %}
                                <span class="hub-badge hub-badge-top">
                                    Топ продажів
                                </span>
                                {% endif %}
                                
                                {% if course.is_coming_soon %}
                                <span class="hub-badge hub-badge-coming-soon">
                                    Незабаром
                                </span>
                                {% endif %}
                                
                                {% if course.is_new %}
                                <span class="hub-badge hub-badge-new">
                                    Новинка
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            <h1 class="course-title">{{ course.title }}</h1>
                            
                            <p class="course-description">{{ course.description }}</p>
                            
                            <div class="course-meta-grid">
                                <div class="meta-item">
                                    <span class="meta-label">Ціна:</span>
                                    {% if course.has_discount and course.discount_percent > 0 %}
                                    <div class="meta-value price has-discount">
                                        <span class="course-price-old">{{ course.price|floatformat:0 }}₴</span>
                                        <span class="course-price-new">{{ course.get_discounted_price|floatformat:0 }}₴</span>
                                    </div>
                                    {% else %}
                                    <span class="meta-value price">{{ course.price|floatformat:0 }}₴</span>
                                    {% endif %}
                                </div>
                                
                                {% if target_audience_display %}
                                <div class="meta-item">
                                    <span class="meta-label">Кому підходить:</span>
                                    <span class="meta-value">{{ target_audience_display|join:", " }}</span>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="course-actions">
                                <a href="{{ join_url }}" class="btn btn-primary btn-large" target="_blank" rel="noopener">
                                    Придбати
                                </a>
                            </div>
                        </div>
                        
                        <!-- Right: Video/Logo Block -->
                        <div class="course-video-block{% if promo_embed_url %} course-video-block--video{% elif course.logo %} course-video-block--logo{% endif %}">
                            {% if promo_embed_url %}
                            <iframe id="promoVideoIframe"
                                    src="{{ promo_embed_url }}?autoplay=false" 
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" 
                                    allowfullscreen>
                            </iframe>
                            {% elif course.logo %}
                            <img src="{{ course.logo.url }}" alt="{{ course.title }}" class="course-logo-display">
                            {% elif course.thumbnail %}
                            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}">
                            {% endif %}
                        </div>
                        
                    </div>
                </div>
            </section>
            
            <!-- RELATED COURSES CAROUSEL -->
            {% if related_courses %}
            <section class="fullscreen-section related-courses-section">
                <div class="section-content">
                    <h2 class="section-title">Схожі курси</h2>
                    <div class="courses-carousel">
                        <div class="courses-track">
                            {% for related in related_courses %}
                            <article class="course-card-horizontal">
                                <div class="course-card-image">
                                    {% if related.thumbnail %}
                                    <img src="{{ related.thumbnail.url }}" alt="{{ related.title }}" loading="lazy">
                                    {% endif %}
                                </div>
                                <div class="course-card-content">
                                    <h3><a href="{{ related.get_absolute_url }}">{{ related.title }}</a></h3>
                                    <p>{{ related.short_description|truncatewords:15 }}</p>
                                    <div class="course-card-footer">
                                        <span class="price">{{ related.price }}₴</span>
                                    </div>
                                </div>
                            </article>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </section>
            {% endif %}
            
        </div>
    </div>
</div>

<!-- AFTER VIDEO POPUP -->
{% if promo_embed_url %}
<div id="afterPromoPopup" class="promo-popup" style="display: none;">
    <div class="popup-overlay" data-close-popup></div>
    <div class="popup-container">
        <div class="popup-content">
            <h3>Хочете дізнатися більше?</h3>
            <p>Приєднуйтесь до нас та отримайте повний доступ до курсу!</p>
            <div class="popup-actions">
                <a href="{{ join_url }}" class="btn btn-primary" target="_blank" rel="noopener">
                    Придбати
                </a>
                <button class="btn btn-outline" data-close-popup>
                    Закрити
                </button>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
{% if promo_embed_url %}
<script src="{% static 'js/course-detail-promo.js' %}" defer></script>
{% endif %}
{% endblock %}
