{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Play Vision{% endblock %}
{% block meta_description %}{{ course.short_description }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/section-base.css' %}">
<link rel="stylesheet" href="{% static 'css/components/unified-sections.css' %}">
<link rel="stylesheet" href="{% static 'css/components/course-detail-unified.css' %}">
{% endblock %}

{% block content %}
<div class="fullscreen-container">
    <div class="unified-sections-wrapper">
        <div class="unified-sections-container">
            
            <!-- SECTION 1: COURSE HERO -->
            <section class="fullscreen-section course-detail-hero">
                <div class="section-content">
                    <div class="course-hero-grid">
                        
                        <!-- Left: Info Block -->
                        <div class="course-info-block">
                            <nav class="breadcrumb">
                                <a href="{% url 'content:course_list' %}">–•–∞–± –∑–Ω–∞–Ω—å</a>
                                <span>/</span>
                                <span>{{ course.title }}</span>
                            </nav>
                            
                            {% if course.is_featured %}
                            <span class="badge badge-featured">—Ç–æ–ø-–ø—Ä–æ–¥–∞–∂—ñ–≤</span>
                            {% endif %}
                            
                            <h1 class="course-title">{{ course.title }}</h1>
                            
                            {% if course.author %}
                            <p class="course-author">–ê–≤—Ç–æ—Ä: {{ course.author }}</p>
                            {% endif %}
                            
                            <p class="course-description">{{ course.description }}</p>
                            
                            <div class="course-meta-grid">
                                <div class="meta-item">
                                    <span class="meta-label">–¶—ñ–Ω–∞:</span>
                                    <span class="meta-value price">{{ course.price }}‚Ç¥</span>
                                </div>
                                {% if course.author %}
                                <div class="meta-item">
                                    <span class="meta-label">–ê–≤—Ç–æ—Ä:</span>
                                    <span class="meta-value">{{ course.author }}</span>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="course-actions">
                                <a href="{{ join_url }}" class="btn btn-primary btn-large" target="_blank" rel="noopener">
                                    –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—å –¥–æ –∫–ª—É–±—É
                                </a>
                                
                                {% if has_promo %}
                                <button class="btn btn-outline btn-large" 
                                        data-open-promo-modal
                                        data-bunny-id="{{ course.promo_video_bunny_id }}">
                                    <svg class="btn-icon" viewBox="0 0 24 24">
                                        <path d="M8,5.14V19.14L19,12.14L8,5.14Z" />
                                    </svg>
                                    –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø—Ä–æ–º–æ
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Right: Thumbnail -->
                        <div class="course-thumbnail-block">
                            {% if course.thumbnail %}
                            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" loading="lazy">
                            {% else %}
                            <img src="{% static 'images/placeholder-1200x600.svg' %}" alt="{{ course.title }}" loading="lazy">
                            {% endif %}
                        </div>
                        
                    </div>
                </div>
            </section>
            
            <!-- SECTION 2: WHAT YOU GET -->
            <section class="fullscreen-section course-benefits-section">
                <div class="section-content">
                    <h2 class="section-title">–©–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ</h2>
                    <div class="benefits-grid">
                        <div class="benefit-item">
                            <div class="benefit-icon">üìö</div>
                            <h3>–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç</h3>
                            <p>–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –≤—ñ–¥ –µ–∫—Å–ø–µ—Ä—Ç—ñ–≤ —ñ–Ω–¥—É—Å—Ç—Ä—ñ—ó</p>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">üéØ</div>
                            <h3>–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏</h3>
                            <p>–†–µ–∞–ª—å–Ω—ñ –∫–µ–π—Å–∏ —Ç–∞ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∑–Ω–∞–Ω—å</p>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">üèÜ</div>
                            <h3>–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ä–æ–∑–≤–∏—Ç–æ–∫</h3>
                            <p>–†–æ–∑–≤–∏—Ç–æ–∫ –∫–∞—Ä'—î—Ä–∏ —É —Ñ—É—Ç–±–æ–ª—å–Ω—ñ–π —ñ–Ω–¥—É—Å—Ç—Ä—ñ—ó</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- SECTION 3: RELATED COURSES -->
            {% if related_courses %}
            <section class="fullscreen-section related-courses-section">
                <div class="section-content">
                    <h2 class="section-title">–°—Ö–æ–∂—ñ –∫—É—Ä—Å–∏</h2>
                    <div class="courses-grid">
                        {% for related in related_courses %}
                        <article class="course-card">
                            <div class="course-card-image">
                                {% if related.thumbnail %}
                                <img src="{{ related.thumbnail.url }}" alt="{{ related.title }}" loading="lazy">
                                {% else %}
                                <img src="{% static 'images/placeholder-1200x600.svg' %}" alt="{{ related.title }}" loading="lazy">
                                {% endif %}
                            </div>
                            <div class="course-card-content">
                                <h3><a href="{{ related.get_absolute_url }}">{{ related.title }}</a></h3>
                                <p>{{ related.short_description }}</p>
                                <div class="course-card-footer">
                                    <span class="price">{{ related.price }}‚Ç¥</span>
                                </div>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}
            
        </div>
    </div>
</div>

<!-- PROMO VIDEO MODAL -->
{% if has_promo %}
<div id="promoModal" class="promo-modal" style="display: none;" role="dialog" aria-hidden="true">
    <div class="modal-overlay" data-close-modal></div>
    <div class="modal-container">
        <div class="modal-header">
            <h3>–ü—Ä–æ–º–æ –∫—É—Ä—Å—É</h3>
            <button class="modal-close" data-close-modal aria-label="–ó–∞–∫—Ä–∏—Ç–∏">&times;</button>
        </div>
        <div class="modal-body">
            <iframe id="promoVideoFrame" 
                    src="" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
        </div>
    </div>
</div>

<!-- AFTER PROMO POPUP -->
<div id="afterPromoPopup" class="promo-popup" style="display: none;">
    <div class="popup-overlay" data-close-popup></div>
    <div class="popup-container">
        <div class="popup-content">
            <h3>–•–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ?</h3>
            <p>–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∫—É—Ä—Å—É!</p>
            <div class="popup-actions">
                <a href="{{ join_url }}" class="btn btn-primary" target="_blank" rel="noopener">
                    –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—å –∑–∞—Ä–∞–∑
                </a>
                <button class="btn btn-outline" data-close-popup>
                    –ó–∞–∫—Ä–∏—Ç–∏
                </button>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
{% if has_promo %}
<script src="{% static 'js/course-detail-promo.js' %}" defer></script>
{% endif %}
{% endblock %}
