{% extends 'base/base.html' %}
{% load static %}
{% load cms_tags %}

{% block title %}Хаб Знань - Play Vision{% endblock %}

{% block meta_description %}Освітні програми та матеріали для футбольних фахівців. Курси, книги, відео від провідних
експертів галузі.{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/section-base.css' %}">
<link rel="stylesheet" href="{% static 'css/components/unified-sections.css' %}">
<link rel="stylesheet" href="{% static 'css/components/hub-knowledge.css' %}">
<link rel="stylesheet" href="{% static 'css/components/hub-hero.css' %}">
<link rel="stylesheet" href="{% static 'css/components/hub-carousel.css' %}">
<link rel="stylesheet" href="{% static 'css/components/hub-catalog.css' %}">
<link rel="stylesheet" href="{% static 'css/components/htmx-indicators.css' %}">
<link rel="stylesheet" href="{% static 'css/components/search.css' %}">
<link rel="stylesheet" href="{% static 'css/components/hub-filters.css' %}">
<link rel="stylesheet" href="{% static 'css/components/hub-favorites-hide.css' %}">
{% endblock %}

{% block content %}
{% get_hub_hero as hub_hero %}
<div class="fullscreen-container">
    <div class="unified-sections-wrapper">
        <div class="unified-sections-container">

            <!-- HUB HERO SECTION -->
            <section class="hub-hero-section">
                {% if hub_hero %}
                <!-- CMS Hero Data for JS -->
                <script type="application/json" id="hub-hero-slides-data">
                [
                    {% for i in "12345" %}
                    {% if i == "1" or hub_hero|get_title:i %}
                    {% if not forloop.first %},{% endif %}
                    {% get_hub_hero_title hub_hero i country_code as slide_title %}
                    {% get_hub_hero_subtitle hub_hero i country_code as slide_subtitle %}
                    {
                        "title": "{{ slide_title|escapejs }}",
                        "subtitle": "{{ slide_subtitle|escapejs }}",
                        "image": {% with bg_img=hub_hero|get_background_image:i %}{% if bg_img and bg_img.url %}"{{ bg_img.url|escapejs }}"{% else %}null{% endif %}{% endwith %},
                        "video": {% with bg_vid=hub_hero|get_background_video:i %}{% if bg_vid and bg_vid.url %}"{{ bg_vid.url|escapejs }}"{% else %}null{% endif %}{% endwith %}
                    }
                    {% endif %}
                    {% endfor %}
                ]
                </script>
                {% endif %}
                <div class="hub-hero-grid">

                    <!-- Лівий блок з анімованими написами -->
                    <div class="hub-hero-main">
                        <div class="hub-hero-bg">
                            {% if hub_hero %}
                                {% with bg_image=hub_hero|get_background_image:"1" %}
                                {% if bg_image %}
                                    <img src="{{ bg_image.url }}" alt="Хаб знань Play Vision" class="hub-hero-bg-image" loading="eager">
                                {% else %}
                                    <img src="{% static 'images/Hiro.png' %}" alt="Хаб знань Play Vision" class="hub-hero-bg-image" loading="eager">
                                {% endif %}
                                {% endwith %}
                            {% else %}
                                <img src="{% static 'images/Hiro.png' %}" alt="Хаб знань Play Vision" class="hub-hero-bg-image" loading="eager">
                            {% endif %}
                        </div>
                        <div class="hub-hero-content">
                            <!-- Логотип вгорі -->
                            <div class="hub-hero-logo">
                                <img src="{% static 'images/footerlogoblack.svg' %}" alt="Play Vision" loading="eager">
                            </div>
                            <!-- Заголовок -->
                            <h1 class="hero-title"></h1>
                            <!-- Опис -->
                            <p class="hero-subtitle"></p>
                            <!-- Нижня лінія: точки (ліворуч) + кнопка (праворуч) -->
                            <div class="hero-bottom-row">
                                <div class="hero-slider-dots"></div>
                                <div class="hero-buttons">
                                    <a href="#" class="hub-btn">
                                        <span class="btn-text">Дізнайтися</span>
                                        <span class="btn-logo-space"></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Картка 2 -->
                    <a href="#catalog" class="hub-stat-card hub-stat-card-2">
                        <div class="hub-stat-label">Ексклюзивних</div>
                        <div class="hub-stat-value">100+</div>
                        <div class="hub-stat-desc">матеріалів</div>
                    </a>

                    <!-- Чорний слоган -->
                    <div class="hub-hero-slogan">
                        <span class="hub-slogan-highlight">Хаб</span> Знань-знання в дії
                    </div>

                </div>
            </section>

            <!-- НАЙКРАЩІ КУРСИ (Featured Carousel) -->
            <section class="hub-featured-section">
                <div class="section-content">
                    <div class="hub-featured-header">
                        <h2 class="section-title">Найпопулярніші освітні продукти</h2>
                        <div class="hub-featured-nav">
                            <button class="hub-nav-btn hub-nav-prev" aria-label="Попередній">
                                <svg width="24" height="24" viewBox="0 0 24 24">
                                    <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" />
                                </svg>
                            </button>
                            <button class="hub-nav-btn hub-nav-next" aria-label="Наступний">
                                <svg width="24" height="24" viewBox="0 0 24 24">
                                    <path d="M9 18l6-6-6-6" fill="none" stroke="currentColor" stroke-width="2" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="hub-featured-carousel">
                        {% if featured_courses %}
                        {% for course in featured_courses %}
                        <article class="hub-featured-card">
                            <!-- Бейджі для featured -->
                            {% if course.has_discount or course.is_top_seller or course.is_coming_soon or course.is_new %}
                            <div class="hub-featured-badges">
                                {% if course.has_discount and course.discount_percent > 0 %}
                                <span class="hub-badge hub-badge-discount">
                                    Знижка -{{ course.discount_percent }}%
                                </span>
                                {% endif %}
                                
                                {% if course.is_top_seller %}
                                <span class="hub-badge hub-badge-top">
                                    Топ продажів
                                </span>
                                {% endif %}
                                
                                {% if course.is_coming_soon %}
                                <span class="hub-badge hub-badge-coming-soon">
                                    Незабаром
                                </span>
                                {% endif %}
                                
                                {% if course.is_new %}
                                <span class="hub-badge hub-badge-new">
                                    Новинка
                                </span>
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            <div class="hub-featured-content">
                                <h3 class="hub-featured-title">{{ course.title }}</h3>
                                <p class="hub-featured-subtitle">{{ course.short_description }}</p>
                                
                                <!-- Кнопка toggle для мобільних -->
                                <button type="button" 
                                        class="hub-featured-toggle" 
                                        aria-expanded="false" 
                                        aria-label="Показати повний опис">
                                    <span class="toggle-text">ще...</span>
                                </button>
                                
                                <!-- Обгортка для згортаємого контенту -->
                                <div class="hub-featured-description-wrapper">
                                    <div class="hub-featured-description">
                                        {{ course.description|truncatewords:50 }}
                                    </div>
                                </div>
                                
                                <div class="hub-featured-meta">
                                    Кому підходить:
                                    {% for audience in course.get_target_audience_display|slice:":3" %}
                                    {{ audience }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                                    <div class="hub-featured-divider"></div>
                                    <div class="hub-featured-footer">
                                        {% if course.has_discount and course.discount_percent > 0 %}
                                        <a href="{{ course.get_absolute_url }}" class="hub-featured-price has-discount">
                                            <div class="hub-price-old">{{ course.price|floatformat:0 }}₴</div>
                                            <div class="hub-price-new">
                                                <span class="price-label">Ціна:</span>
                                                <span class="price-value">{{ course.get_discounted_price|floatformat:0 }}₴</span>
                                            </div>
                                        </a>
                                        {% else %}
                                        <a href="{{ course.get_absolute_url }}" class="hub-featured-price">
                                            <span class="price-label">Ціна:</span>
                                            <span class="price-value">{{ course.price }}₴</span>
                                        </a>
                                        {% endif %}
                                        <button type="button" class="hub-favorite-btn" data-course-id="{{ course.id }}" {% if course.id in user_favorites %}data-favorited="true"{% endif %} aria-label="Додати до улюблених">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                                            </svg>
                                        </button>
                                    </div>
                            </div>
                                <div class="hub-featured-image">
                                    {% if course.logo %}
                                    <img src="{{ course.logo.url }}" alt="{{ course.title }}" loading="lazy">
                                    {% else %}
                                    <img src="{% static 'images/placeholder-square.svg' %}" alt="{{ course.title }}" loading="lazy">
                                    {% endif %}
                                </div>
                        </article>
                        {% endfor %}
                        {% else %}
                        <div class="hub-no-featured">
                            <p>Найкращі курси скоро з'являться</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </section>

            <!-- КАТАЛОГ -->
            <section class="hub-catalog-section" id="catalog">
                <div class="section-content">
                    
                    <div class="hub-catalog-layout">
                        
                        <!-- SIDEBAR ФІЛЬТРІВ -->
                        <aside class="hub-filters-sidebar">
                            <!-- Шапка для мобільної версії -->
                            <div class="hub-filters-header">
                                <h2 class="hub-filters-title-mobile">Фільтрувати</h2>
                                <button type="button" 
                                        class="hub-filters-close-btn" 
                                        id="hub-filters-close"
                                        aria-label="Закрити фільтри">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <h2 class="hub-filters-title">Фільтрувати</h2>
                            
                            <!-- Фільтри -->
                            <div class="hub-filters-list">
                                <!-- Тренерство (з dropdown) -->
                                <div class="hub-filter-item">
                                    <div class="hub-filter-header" data-dropdown="coaching">
                                        <span class="hub-filter-label">Тренерство</span>
                                        <svg class="hub-filter-arrow" viewBox="0 0 24 24">
                                            <path d="M7 10l5 5 5-5z"/>
                                        </svg>
                                    </div>
                                    <div class="hub-filter-submenu" data-submenu="coaching">
                                        <label class="hub-filter-subitem">
                                            <input type="checkbox" name="audience" value="coach_goalkeeper">
                                            <span>Тренер воротарів</span>
                                        </label>
                                        <label class="hub-filter-subitem">
                                            <input type="checkbox" name="audience" value="coach_youth">
                                            <span>Дитячий тренер</span>
                                        </label>
                                        <label class="hub-filter-subitem">
                                            <input type="checkbox" name="audience" value="coach_fitness">
                                            <span>Тренер ЗФП</span>
                                        </label>
                                        <label class="hub-filter-subitem">
                                            <input type="checkbox" name="audience" value="coach_pro">
                                            <span>Тренер професійних команд</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Аналітика і скаутинг -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="analyst_scout">
                                        <input type="checkbox" name="audience" value="analyst_scout" style="display: none;">
                                        <span class="hub-filter-label">Аналітика і скаутинг</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                                
                                <!-- Менеджмент -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="management">
                                        <input type="checkbox" name="audience" value="management" style="display: none;">
                                        <span class="hub-filter-label">Менеджмент</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                                
                                <!-- Спортивна психологія -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="psychology">
                                        <input type="checkbox" name="audience" value="psychology" style="display: none;">
                                        <span class="hub-filter-label">Спортивна психологія</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                                
                                <!-- Нутриціологія -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="nutrition">
                                        <input type="checkbox" name="audience" value="nutrition" style="display: none;">
                                        <span class="hub-filter-label">Нутриціологія</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                                
                                <!-- Реабілітація -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="rehabilitation">
                                        <input type="checkbox" name="audience" value="rehabilitation" style="display: none;">
                                        <span class="hub-filter-label">Реабілітація</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                                
                                <!-- Футболіст -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="player">
                                        <input type="checkbox" name="audience" value="player" style="display: none;">
                                        <span class="hub-filter-label">Футболіст</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                                
                                <!-- Батько -->
                                <div class="hub-filter-item">
                                    <label class="hub-filter-header" data-checkbox="parent">
                                        <input type="checkbox" name="audience" value="parent" style="display: none;">
                                        <span class="hub-filter-label">Батько</span>
                                        <div class="hub-filter-checkbox"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Кнопки -->
                            <div class="hub-filter-actions">
                                <button type="button" class="hub-filter-btn hub-filter-btn-apply" id="apply-filters">
                                    <svg class="hub-filter-btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"/>
                                        <path d="M21 21l-4.35-4.35" stroke-linecap="round"/>
                                    </svg>
                                    <span class="hub-filter-btn-text">Шукати</span>
                                </button>
                                <button type="button" class="hub-filter-btn hub-filter-btn-cancel" id="cancel-filters">
                                    <svg class="hub-filter-btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6"/>
                                        <path d="M5 6l1 14c0 1 1 2 2 2h8c1 0 2-1 2-2l1-14"/>
                                    </svg>
                                    <span class="hub-filter-btn-text">Очистити</span>
                                </button>
                            </div>
                        </aside>
                        
                        <!-- КОНТЕНТ -->
                        <div class="hub-content-column">
                            
                            <!-- Плаваюча кнопка фільтрів (тільки моб/планшет) -->
                            <button type="button" 
                                    class="hub-filters-toggle-btn" 
                                    id="hub-filters-toggle"
                                    aria-label="Відкрити фільтри"
                                    aria-expanded="false">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="4" y1="6" x2="20" y2="6"/>
                                    <line x1="4" y1="12" x2="20" y2="12"/>
                                    <line x1="4" y1="18" x2="20" y2="18"/>
                                </svg>
                                <span>Фільтри</span>
                            </button>
                            
                            <!-- ПОШУК -->
                            <div class="hub-search-bar">
                                <svg class="hub-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                                    <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                                <input type="text" id="hub-search-field" 
                                       class="hub-search-field" 
                                       placeholder="Пошук"
                                       aria-label="Пошук курсів">
                                <button type="button" class="hub-search-btn hub-search-btn-find" id="hub-search-find">
                                    Знайти
                                </button>
                                <button type="button" class="hub-search-btn hub-search-btn-reset" id="hub-search-reset">
                                    Скинути
                                </button>
                            </div>
                            
                            <!-- Глобальний індикатор для каталогу -->
                            <div id="catalog-loading-indicator" class="htmx-loading" style="display: none;">
                                Завантаження...
                            </div>
                            
                            <div id="catalog-content" 
                                 hx-indicator="#catalog-loading-indicator">
                                {% include 'hub/partials/catalog_grid.html' %}
                            </div>
                        </div>
                        
                    </div>
                </div>
            </section>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/hub-knowledge.js' %}" defer></script>
<script src="{% static 'js/hub-filters.js' %}" defer></script>
{% endblock %}