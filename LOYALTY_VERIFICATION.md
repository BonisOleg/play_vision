# ‚úÖ –í–ï–†–ò–§–Ü–ö–ê–¶–Ü–Ø –ü–†–û–ì–†–ê–ú–ò –õ–û–Ø–õ–¨–ù–û–°–¢–Ü

## üìä –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Å–∫—Ä—ñ–Ω–∞–º

### 1. –ú–∞—Ç—Ä–∏—Ü—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∑–∞ –ø–æ–∫—É–ø–∫–∏ (–°–∫—Ä—ñ–Ω 3) ‚úÖ

| –î—ñ–∞–ø–∞–∑–æ–Ω | –ë–µ–∑ –ø—ñ–¥–ø–∏—Å–∫–∏ | C/B-Vision | A/Pro-Vision |
|----------|--------------|------------|--------------|
| ‚Ç¥399-1000 | ‚úÖ 5 –±–∞–ª—ñ–≤ | ‚úÖ 8 –±–∞–ª—ñ–≤ | ‚úÖ 10 –±–∞–ª—ñ–≤ |
| ‚Ç¥1000-3000 | ‚úÖ 10 –±–∞–ª—ñ–≤ | ‚úÖ 15 –±–∞–ª—ñ–≤ | ‚úÖ 20 –±–∞–ª—ñ–≤ |
| ‚Ç¥3000+ | ‚úÖ 15 –±–∞–ª—ñ–≤ | ‚úÖ 23 –±–∞–ª—ñ–≤ | ‚úÖ 30 –±–∞–ª—ñ–≤ |

**–§–∞–π–ª:** `apps/loyalty/management/commands/init_loyalty_rules.py` (—Ä—è–¥–∫–∏ 19-40)
**–õ–æ–≥—ñ–∫–∞:** `apps/loyalty/models.py` –º–µ—Ç–æ–¥ `get_points_for_purchase` (—Ä—è–¥–∫–∏ 252-275)

### 2. –ù–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∑–∞ –ø—ñ–¥–ø–∏—Å–∫–∏ (–°–∫—Ä—ñ–Ω 3) ‚úÖ

**C-Vision / B-Vision:**
- ‚úÖ 1 –º—ñ—Å—è—Ü—å ‚Üí +15 –±–∞–ª—ñ–≤
- ‚úÖ 3 –º—ñ—Å—è—Ü—ñ ‚Üí +50 –±–∞–ª—ñ–≤
- ‚úÖ 6 –º—ñ—Å—è—Ü—ñ–≤ ‚Üí +100 –±–∞–ª—ñ–≤
- ‚úÖ 1 —Ä—ñ–∫ ‚Üí +200 –±–∞–ª—ñ–≤

**A-Vision / Pro-Vision:**
- ‚úÖ 3 –º—ñ—Å—è—Ü—ñ ‚Üí +80 –±–∞–ª—ñ–≤
- ‚úÖ 6 –º—ñ—Å—è—Ü—ñ–≤ ‚Üí +160 –±–∞–ª—ñ–≤
- ‚úÖ 1 —Ä—ñ–∫ ‚Üí +320 –±–∞–ª—ñ–≤

**–§–∞–π–ª:** `apps/loyalty/management/commands/init_loyalty_rules.py` (—Ä—è–¥–∫–∏ 56-77)
**–õ–æ–≥—ñ–∫–∞:** `apps/loyalty/models.py` –º–µ—Ç–æ–¥ `get_points_for_subscription` (—Ä—è–¥–∫–∏ 278-291)

### 3. –í–∏—Ç—Ä–∞—Ç–∞ –±–∞–ª—ñ–≤ (–°–∫—Ä—ñ–Ω 4) ‚úÖ

**–ë–µ–∑ –ø—ñ–¥–ø–∏—Å–∫–∏:**
- ‚úÖ 50 –±–∞–ª—ñ–≤ ‚Üí –∑–Ω–∏–∂–∫–∞ 5%
- ‚úÖ 100 –±–∞–ª—ñ–≤ ‚Üí –∑–Ω–∏–∂–∫–∞ 10%
- ‚úÖ –ü—Ä–∏–¥–±–∞–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ (PDF, —Å—Ç–∞—Ç—Ç—ñ, –≤—ñ–¥–µ–æ)
- ‚úÖ –ß–∞—Å—Ç–∫–æ–≤–∞ –æ–ø–ª–∞—Ç–∞ C/B-Vision –ø—ñ–¥–ø–∏—Å–∫–∏

**–ó –ø—ñ–¥–ø–∏—Å–∫–æ—é:**
- ‚úÖ –í—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ "–ë–µ–∑ –ø—ñ–¥–ø–∏—Å–∫–∏"
- ‚úÖ –û–±–º—ñ–Ω –Ω–∞ –º—ñ—Å—è—Ü—å –ø—ñ–¥–ø–∏—Å–∫–∏ (200-500 –±–∞–ª—ñ–≤)
- ‚úÖ –ó–Ω–∏–∂–∫–∏ –Ω–∞ —ñ–≤–µ–Ω—Ç–∏
- ‚úÖ –ö—É–ø—ñ–≤–ª—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤

**–§–∞–π–ª:** `apps/loyalty/management/commands/init_loyalty_rules.py` (—Ä—è–¥–∫–∏ 88-132)
**–õ–æ–≥—ñ–∫–∞:** `apps/loyalty/models.py` –∫–ª–∞—Å–∏ `RedemptionOption` —Ç–∞ –º–µ—Ç–æ–¥ `get_discount_percentage`

### 4. UI - –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–∞–ª—ñ–≤ –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö (–°–∫—Ä—ñ–Ω 5) ‚úÖ

**–ü—Ä–∏–∫–ª–∞–¥ –∑—ñ —Å–∫—Ä—ñ–Ω—É:**
- –¢–∞–∫—Ç–∏–∫–∞ 4-3-3 (‚Ç¥750) ‚Üí ‚úÖ +5 –±–∞–ª—ñ–≤
- –•–∞—Ä—á—É–≤–∞–Ω–Ω—è (‚Ç¥600) ‚Üí ‚úÖ +5 –±–∞–ª—ñ–≤
- –ê–Ω–∞–ª—ñ–∑ (‚Ç¥2500) ‚Üí ‚úÖ +10 –±–∞–ª—ñ–≤
- –ú–µ–¥—ñ–∞ (‚Ç¥3500) ‚Üí ‚úÖ +15 –±–∞–ª—ñ–≤

**–§–∞–π–ª–∏:**
- `templates/hub/course_list.html` (—Ä—è–¥–∫–∏ 600-606) - –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- `apps/content/views.py` (—Ä—è–¥–∫–∏ 91-99) - –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö
- `static/css/components/hub.css` (—Ä—è–¥–∫–∏ 1182-1192) - —Å—Ç–∏–ª—ñ
- `apps/content/templatetags/loyalty_filters.py` - template filter

### 5. –ü—Ä–∞–≤–∏–ª–∞ (Template) (–°–∫—Ä—ñ–Ω 1, 2, 7) ‚úÖ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–≥—ñ–¥–Ω–æ —Å–∫—Ä—ñ–Ω—ñ–≤:**
- ‚úÖ Hero banner –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏ (10-30 –±–∞–ª—ñ–≤, 50=5%)
- ‚úÖ "–©–æ —Ç–∞–∫–µ –±–∞–ª–∏?" - —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—è —Å–∏—Å—Ç–µ–º–∏
- ‚úÖ –¢–∞–±–ª–∏—Ü—è "–Ø–∫ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –±–∞–ª–∏" (–º–∞—Ç—Ä–∏—Ü—è 3√ó3)
- ‚úÖ "–ó–∞ –ø—ñ–¥–ø–∏—Å–∫–∏" –∑ –¥–≤–æ–º–∞ —Å–µ–∫—Ü—ñ—è–º–∏
- ‚úÖ "–Ø–∫ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ –±–∞–ª–∏?" - –¥–≤–∞ —Ä—ñ–≤–Ω—ñ –¥–æ—Å—Ç—É–ø—É
- ‚úÖ "–î–ª—è —á–æ–≥–æ –Ω–∞–º –ø—Ä–æ–≥—Ä–∞–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ?"
- ‚úÖ "–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏" - 9 –ø—É–Ω–∫—Ç—ñ–≤ —Ä–æ–∑–≤–∏—Ç–∫—É

**–§–∞–π–ª–∏:**
- `templates/loyalty/rules.html` - –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∏–π
- `static/css/components/loyalty-rules.css` - —Å—Ç–∏–ª—ñ

### 6. –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Payments ‚úÖ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è:**
- ‚úÖ –ü—Ä–∏ —É—Å–ø—ñ—à–Ω—ñ–π –æ–ø–ª–∞—Ç—ñ –∫—É—Ä—Å—ñ–≤/—ñ–≤–µ–Ω—Ç—ñ–≤ ‚Üí `award_loyalty_points`
- ‚úÖ –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ñ –ø—ñ–¥–ø–∏—Å–∫–∏ ‚Üí `award_subscription_loyalty_points`
- ‚úÖ –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚úÖ –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (–Ω–µ –±–ª–æ–∫—É—î –ø–ª–∞—Ç—ñ–∂)

**–§–∞–π–ª:** `apps/payments/services.py` (—Ä—è–¥–∫–∏ 152, 234, 270-316)

### 7. Admin Panel ‚úÖ

**–ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:**
- ‚úÖ `PointEarningRule` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è
- ‚úÖ `RedemptionOption` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–ø—Ü—ñ–π –≤–∏—Ç—Ä–∞—Ç–∏
- ‚úÖ `LoyaltyAccount` - –ø–µ—Ä–µ–≥–ª—è–¥ –±–∞–ª–∞–Ω—Å—ñ–≤
- ‚úÖ `PointTransaction` - —ñ—Å—Ç–æ—Ä—ñ—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- ‚úÖ –ó—Ä—É—á–Ω—ñ fieldsets —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

**–§–∞–π–ª:** `apps/loyalty/admin.py`

## üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### Models ‚úÖ
```python
‚úÖ LoyaltyTier (legacy - –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ)
‚úÖ LoyaltyAccount (points, lifetime_points, tier)
‚úÖ PointTransaction (—ñ—Å—Ç–æ—Ä—ñ—è)
‚úÖ PointEarningRule (–ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è)
‚úÖ RedemptionOption (–æ–ø—Ü—ñ—ó –≤–∏—Ç—Ä–∞—Ç–∏)
```

### Services ‚úÖ
```python
‚úÖ get_or_create_account
‚úÖ get_user_subscription_tier
‚úÖ award_points_for_purchase
‚úÖ award_points_for_subscription
‚úÖ calculate_discount_from_points
‚úÖ apply_discount_for_points
‚úÖ get_points_for_course_display
‚úÖ redeem_subscription_month
```

### Management Commands ‚úÖ
```bash
‚úÖ python manage.py init_loyalty_rules
   - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î 16 –ø—Ä–∞–≤–∏–ª –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è
   - –°—Ç–≤–æ—Ä—é—î 4 –æ–ø—Ü—ñ—ó –≤–∏—Ç—Ä–∞—Ç–∏
```

## ‚ö†Ô∏è –©–æ –∑–∞–ª–∏—à–∏–ª–æ—Å—å

### 1. –ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ñ–ª—ñ–∫—Ç –∑ `apps/events` –º–æ–¥–µ–ª—è–º–∏
**–†—ñ—à–µ–Ω–Ω—è:** –ü–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ events models –ø–µ—Ä–µ–¥ –º—ñ–≥—Ä–∞—Ü—ñ—î—é

### 2. –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≤–∏—Ç—Ä–∞—Ç–∏ –≤ Checkout
**–°—Ç–∞—Ç—É—Å:** –õ–æ–≥—ñ–∫–∞ —î –≤ services, –∞–ª–µ –Ω–µ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ –≤ cart/checkout flow
**–ü–æ—Ç—Ä—ñ–±–Ω–æ:**
- –î–æ–¥–∞—Ç–∏ UI –≤–∏–±–æ—Ä—É –∑–Ω–∏–∂–∫–∏ –≤ –∫–æ—à–∏–∫—É
- –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ apply_discount_for_points –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ñ
- –î–æ–¥–∞—Ç–∏ –æ–ø—Ü—ñ—é –æ–±–º—ñ–Ω—É –Ω–∞ –º—ñ—Å—è—Ü—å –ø—ñ–¥–ø–∏—Å–∫–∏

## üìù –í–∏—Å–Ω–æ–≤–æ–∫

**–í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å–∫—Ä—ñ–Ω–∞–º:** 100% ‚úÖ

–í—Å—ñ —Ü–∏—Ñ—Ä–∏, —Ç–∞–±–ª–∏—Ü—ñ, –æ–ø–∏—Å–∏ —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ **—Ç–æ—á–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å** —Å–∫—Ä—ñ–Ω—à–æ—Ç–∞–º:
- ‚úÖ –ú–∞—Ç—Ä–∏—Ü—è 3√ó3 –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è
- ‚úÖ –ë–∞–ª–∏ –∑–∞ –ø—ñ–¥–ø–∏—Å–∫–∏ (15-320)
- ‚úÖ –ó–Ω–∏–∂–∫–∏ 5%/10%
- ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è "+X –±–∞–ª—ñ–≤" –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö
- ‚úÖ Template –∑ —É—Å—ñ–º–∞ —Å–µ–∫—Ü—ñ—è–º–∏
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ payments
- ‚úÖ Admin –ø–∞–Ω–µ–ª—å

**–ö–æ–¥ –±–µ–∑ –ø–æ–º–∏–ª–æ–∫:** 0 linter errors ‚úÖ

**–ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è** –ø—ñ—Å–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π!

