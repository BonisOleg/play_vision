{% extends "base/base.html" %}
{% load static %}

{% block title %}–î–µ–º–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –≤—ñ–¥–µ–æ - Play Vision{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'video_security/css/demo.css' %}">
{% endblock %}

{% block extra_css %}
<style>
    .demo-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
    }

    .secure-video-container {
        position: relative;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        margin: 2rem 0;
    }

    .secure-video,
    .preview-video {
        width: 100%;
        height: auto;
        max-height: 450px;
        display: none;
    }

    .security-features {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        margin: 2rem 0;
    }

    .feature-list {
        list-style: none;
        padding: 0;
    }

    .feature-list li {
        padding: 0.5rem 0;
        border-bottom: 1px solid #dee2e6;
    }

    .feature-list li:last-child {
        border-bottom: none;
    }

    .feature-list li::before {
        content: '‚úÖ';
        margin-right: 0.5rem;
    }

    .demo-controls {
        display: flex;
        gap: 1rem;
        margin: 1rem 0;
        flex-wrap: wrap;
    }

    .status-indicator {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 500;
        margin: 0.5rem 0;
    }

    .status-enabled {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .status-disabled {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>
{% endblock %}

{% block content %}
<div class="demo-container">
    <h1>üõ°Ô∏è –î–µ–º–æ –∑–∞—Ö–∏—â–µ–Ω–æ–≥–æ –≤—ñ–¥–µ–æ</h1>
    <p>–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –∑–∞—Ö–∏—â–µ–Ω–æ—ó –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—ñ–¥–µ–æ –∑ –≤–æ–¥—è–Ω–∏–º–∏ –∑–Ω–∞–∫–∞–º–∏ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –¥–æ—Å—Ç—É–ø—É.</p>

    <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏ -->
    <div class="status-indicator {% if security_enabled %}status-enabled{% else %}status-disabled{% endif %}">
        {% if security_enabled %}
        ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥–µ–æ –£–í–Ü–ú–ö–ù–ï–ù–ê
        {% else %}
        ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥–µ–æ –í–ò–ú–ö–ù–ï–ù–ê (fallback —Ä–µ–∂–∏–º)
        {% endif %}
    </div>

    <!-- –î–µ–º–æ –≤—ñ–¥–µ–æ -->
    <div class="secure-video-container" data-material-id="1" data-has-access="true"
        data-user-email="{{ user.email|default:'demo@example.com' }}">

        <video controls class="secure-video secure-video-hidden">
            <p>–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤—ñ–¥–µ–æ.</p>
        </video>

        <!-- Fallback –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è -->
        <div class="demo-fallback">
            <h3>üé¨ –î–µ–º–æ –≤—ñ–¥–µ–æ</h3>
            <p>–¢—É—Ç –±—É–¥–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –∑–∞—Ö–∏—â–µ–Ω–µ –≤—ñ–¥–µ–æ –∑ –≤–æ–¥—è–Ω–∏–º–∏ –∑–Ω–∞–∫–∞–º–∏</p>
            <p>Email: {{ user.email|default:'demo@example.com' }}</p>
            <p>–ß–∞—Å: <span id="current-time"></span></p>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç—Ä–æ–ª–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è -->
    <div class="demo-controls">
        <button class="btn btn-primary"
            onclick="SecureVideo.loadSecureVideo(document.querySelector('.secure-video-container'), 1)">
            üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—ñ–¥–µ–æ
        </button>
        <button class="btn btn-outline" onclick="testSecurityFeatures()">
            üß™ –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑–∞—Ö–∏—Å—Ç
        </button>
        <button class="btn btn-outline" onclick="showSecurityLog()">
            üìä –õ–æ–≥ –±–µ–∑–ø–µ–∫–∏
        </button>
    </div>

    <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–∞—Ö–∏—Å—Ç—É -->
    <div class="security-features">
        <h3>üîí –ê–∫—Ç–∏–≤–Ω—ñ –∑–∞—Å–æ–±–∏ –∑–∞—Ö–∏—Å—Ç—É:</h3>
        <ul class="feature-list">
            <li><strong>–í–æ–¥—è–Ω—ñ –∑–Ω–∞–∫–∏:</strong> –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –º—ñ—Ç–∫–∏ –∑ email —Ç–∞ —á–∞—Å–æ–º</li>
            <li><strong>–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø—Ä–∞–≤–æ–≥–æ –∫–ª—ñ–∫—É:</strong> –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é</li>
            <li><strong>–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ copy/paste:</strong> –ó–∞–±–æ—Ä–æ–Ω–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—ñ–¥–µ–æ</li>
            <li><strong>–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ drag & drop:</strong> –ù–µ–º–æ–∂–ª–∏–≤–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ –≤—ñ–¥–µ–æ</li>
            <li><strong>–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–∏–π –∑–∞—Ö–∏—Å—Ç:</strong> –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è F12, Ctrl+Shift+I —Ç–∞ —ñ–Ω—à–∏—Ö</li>
            <li><strong>–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ DevTools:</strong> –í–∏—è–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞</li>
            <li><strong>–¢–∏–º—á–∞—Å–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏:</strong> URL –∑ –æ–±–º–µ–∂–µ–Ω–∏–º —á–∞—Å–æ–º –∂–∏—Ç—Ç—è</li>
            <li><strong>–ê–Ω–∞–ª—ñ–∑ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏:</strong> –í–∏—è–≤–ª–µ–Ω–Ω—è –ø—ñ–¥–æ–∑—Ä—ñ–ª–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</li>
            <li><strong>–õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π:</strong> –î–µ—Ç–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Å —É—Å—ñ—Ö –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</li>
        </ul>
    </div>

    <!-- –¢–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è -->
    <div class="security-features">
        <h3>‚öôÔ∏è –¢–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:</h3>
        <ul class="technical-info-list">
            <li><strong>–í–µ—Ä—Å—ñ—è —Å–∏—Å—Ç–µ–º–∏:</strong> Play Vision Video Security v1.0</li>
            <li><strong>–ú–µ—Ç–æ–¥ –∑–∞—Ö–∏—Å—Ç—É:</strong> HMAC-SHA256 —Ç–æ–∫–µ–Ω–∏ + Behavior Analysis</li>
            <li><strong>–ß–∞—Å –∂–∏—Ç—Ç—è —Ç–æ–∫–µ–Ω—ñ–≤:</strong> {{ token_lifetime|default:3600 }} —Å–µ–∫—É–Ω–¥</li>
            <li><strong>–ó–∞—Ö–∏—â–µ–Ω–µ —Å—Ö–æ–≤–∏—â–µ:</strong> {% if aws_enabled %}AWS S3{% else %}–õ–æ–∫–∞–ª—å–Ω—ñ —Ñ–∞–π–ª–∏{% endif %}</li>
            <li><strong>Watermark:</strong> –î–∏–Ω–∞–º—ñ—á–Ω–∏–π, —Ä—É—Ö–æ–º–∏–π</li>
        </ul>
    </div>

    <!-- –õ–æ–≥ –ø–æ–¥—ñ–π -->
    <div id="security-log" class="security-features security-log-hidden">
        <h3>üìã –õ–æ–≥ –ø–æ–¥—ñ–π –±–µ–∑–ø–µ–∫–∏:</h3>
        <div id="log-content" class="log-content">
            –õ–æ–≥ –±—É–¥–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è —Ç—É—Ç...
        </div>
    </div>
</div>

<script>
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—É
    function updateTime() {
        document.getElementById('current-time').textContent = new Date().toLocaleString('uk-UA');
    }
    setInterval(updateTime, 1000);
    updateTime();

    // –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –∑–∞—Ö–∏—Å—Ç—É
    function testSecurityFeatures() {
        alert('üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É:\n\n' +
            '1. –°–ø—Ä–æ–±—É–π—Ç–µ –∫–ª—ñ–∫–Ω—É—Ç–∏ –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –Ω–∞ –≤—ñ–¥–µ–æ\n' +
            '2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å F12 –∞–±–æ Ctrl+Shift+I\n' +
            '3. –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ –≤—ñ–¥–µ–æ\n' +
            '4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Print Screen\n\n' +
            '–í—Å—ñ —Ü—ñ –¥—ñ—ó –º–∞—é—Ç—å –±—É—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ —Ç–∞ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –≤ –ª–æ–∑—ñ.');
    }

    // –ü–æ–∫–∞–∑ –ª–æ–≥—É –±–µ–∑–ø–µ–∫–∏
    let logVisible = false;
    function showSecurityLog() {
        const logDiv = document.getElementById('security-log');
        logVisible = !logVisible;
        logDiv.classList.toggle('security-log-hidden', !logVisible);

        if (logVisible) {
            // –Ü–º—ñ—Ç–∞—Ü—ñ—è –ª–æ–≥—É (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—ñ –±—É–¥–µ –∑ —Å–µ—Ä–≤–µ—Ä–∞)
            const logContent = document.getElementById('log-content');
            logContent.innerHTML = `
[${new Date().toISOString()}] INFO: Secure video system initialized<br>
[${new Date().toISOString()}] INFO: User ${document.querySelector('[data-user-email]').dataset.userEmail} accessed material ID 1<br>
[${new Date().toISOString()}] SECURITY: Watermark applied with dynamic positioning<br>
[${new Date().toISOString()}] SECURITY: Video protection layer activated<br>
[${new Date().toISOString()}] SECURITY: Global security monitoring started<br>
<span class="log-ready">[READY] All security systems operational</span>
        `;
        }
    }

    // –†–æ–∑—à–∏—Ä–µ–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥–µ–º–æ
    const originalLogSecurityEvent = window.SecureVideo?.logSecurityEvent;
    if (originalLogSecurityEvent) {
        window.SecureVideo.logSecurityEvent = function (materialId, eventType, data = {}) {
            originalLogSecurityEvent.call(this, materialId, eventType, data);

            // –î–æ–¥–∞—î–º–æ –¥–æ –¥–µ–º–æ –ª–æ–≥—É
            const logContent = document.getElementById('log-content');
            if (logContent && logVisible) {
                const timestamp = new Date().toISOString();
                const logEntry = `[${timestamp}] SECURITY: ${eventType} on material ${materialId}`;
                logContent.innerHTML += `<br><span class="log-security">${logEntry}</span>`;
                logContent.scrollTop = logContent.scrollHeight;
            }
        };
    }
</script>
{% endblock %}

{% block extra_js %}
<!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –Ω–∞—à JavaScript –ü–Ü–°–õ–Ø main.js -->
<script src="{% static 'video_security/js/secure_video.js' %}"></script>
{% endblock %}