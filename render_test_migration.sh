#!/usr/bin/env bash
# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π –Ω–∞ Render (dry-run)
# –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: render shell playvision -- './render_test_migration.sh'

set -o errexit

echo "=========================================="
echo "üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø –ú–Ü–ì–†–ê–¶–Ü–ô (DRY-RUN)"
echo "=========================================="
echo ""

# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –º–æ–∂–Ω–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
echo "1Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π..."
python manage.py migrate --plan --verbosity 2 subscriptions 2>&1 | head -50
echo ""

# 2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ SQL —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ
echo "2Ô∏è‚É£ SQL —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó 0019..."
python manage.py sqlmigrate subscriptions 0019 2>&1 || echo "‚ö†Ô∏è –ú—ñ–≥—Ä–∞—Ü—ñ—è 0019 —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–∞"
echo ""

# 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ SQL –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó 0020
echo "3Ô∏è‚É£ SQL —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ–Ω–∞–Ω–æ –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó 0020..."
python manage.py sqlmigrate subscriptions 0020 2>&1 || echo "‚ö†Ô∏è –ú—ñ–≥—Ä–∞—Ü—ñ—è 0020 —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–∞"
echo ""

# 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏
echo "4Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π..."
python manage.py check --deploy 2>&1 | grep -i migration || echo "‚úÖ –ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫ –º—ñ–≥—Ä–∞—Ü—ñ–π"
echo ""

# 5. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–¥–µ–ª—ñ
echo "5Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–¥–µ–ª—ñ SubscriptionPlan..."
python manage.py check 2>&1 | grep -i subscription || echo "‚úÖ –ú–æ–¥–µ–ª—å –≤–∞–ª—ñ–¥–Ω–∞"
echo ""

echo "=========================================="
echo "‚úÖ –¢–ï–°–¢–£–í–ê–ù–ù–Ø –ó–ê–í–ï–†–®–ï–ù–ï"
echo "=========================================="
echo ""
echo "‚ö†Ô∏è –¶–ï –ë–£–í DRY-RUN - –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–º—ñ–Ω–µ–Ω–æ –≤ –ë–î"
echo "–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ:"
echo "  python manage.py migrate subscriptions"






