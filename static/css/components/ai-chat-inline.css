/**
 * INLINE AI CHAT IN HEADER
 * –ß–∞—Ç AI —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ —Ö–µ–¥–µ—Ä
 * –ö–†–û–°-–ë–†–ê–£–ó–ï–†–ù–ê –°–£–ú–Ü–°–ù–Ü–°–¢–¨: Chrome, Firefox, Safari (macOS/iOS), Edge, Opera
 */

/* ========================================
   –ì–õ–û–ë–ê–õ–¨–ù–Ü –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –î–õ–Ø –ö–û–ú–ü–û–ù–ï–ù–¢–ê
   ======================================== */

/* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —á–∞—Ç—É */
.ai-chat-inline *,
.ai-chat-modal * {
    /* –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–µ box-sizing */
    box-sizing: border-box;

    /* –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π font rendering –¥–ª—è –≤—Å—ñ—Ö OS */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;

    /* –í–∏–º–∫–Ω–µ–Ω–Ω—è text selection –¥–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ */
    -webkit-tap-highlight-color: transparent;
}

/* –î–æ–∑–≤–æ–ª—è—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –≤ –∫–æ–Ω—Ç–µ–Ω—Ç—ñ */
.ai-message-content,
.ai-chat-input,
.ai-chat-modal-input {
    -webkit-user-select: text;
    -moz-user-select: text;
    user-select: text;
}

/* ========================================
   PLACEHOLDER (—Ä–µ–∑–µ—Ä–≤—É—î –º—ñ—Å—Ü–µ –≤ –æ–≤–∞–ª—ñ)
   ======================================== */

.ai-chat-placeholder {
    width: 280px;
    height: 44px;
    margin-left: 12px;
    flex-shrink: 0;
    /* –ù–µ–≤–∏–¥–∏–º–∏–π, –∞–ª–µ –∑–∞–π–º–∞—î –º—ñ—Å—Ü–µ */
}

/* ========================================
   INLINE CHAT CONTAINER (–≤–∏–≥–ª—è–¥–∞—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ, –∞–ª–µ position: absolute)
   ======================================== */

.header-nav-actions {
    position: relative;
    /* –î–ª—è absolute –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —á–∞—Ç—É */
}

.ai-chat-inline {
    position: absolute;
    width: 300px;
    display: flex;
    flex-direction: column;
    z-index: 100;

    /* üéØ –ó–ú–Ü–ù–Æ–ô–¢–ï –¶–Ü –ó–ù–ê–ß–ï–ù–ù–Ø –î–õ–Ø –ü–û–ó–ò–¶–Ü–û–ù–£–í–ê–ù–ù–Ø:
     * - translateX: –∑–º—ñ—â–µ–Ω–Ω—è –ø—Ä–∞–≤–æ—Ä—É—á/–ª—ñ–≤–æ—Ä—É—á (+ –ø—Ä–∞–≤–æ—Ä—É—á, - –ª—ñ–≤–æ—Ä—É—á)
     * - translateY: –∑–º—ñ—â–µ–Ω–Ω—è –≤–Ω–∏–∑/–≤–≥–æ—Ä—É (+ –≤–Ω–∏–∑, - –≤–≥–æ—Ä—É)
     */
    top: 0;
    right: 0;

    /* –ö–†–ò–¢–ò–ß–ù–û: –û–∫—Ä—É–≥–ª–µ–Ω–Ω—è –¥–æ —Ü—ñ–ª–∏—Ö –ø—ñ–∫—Å–µ–ª—ñ–≤ –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è —Ä–æ–∑–º–∏—Ç—Ç—è */
    transform: translate(-2px, 2px);
    -webkit-transform: translate(-2px, 2px);

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è subpixel rendering */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;

    /* Performance optimization */
    will-change: contents;

    /* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ stacking context */
    isolation: isolate;
}

/* Messages container - –Ü–°–¢–û–†–Ü–Ø –ó–í–ï–†–•–£, –Ü–ù–ü–£–¢ –û–ü–£–°–ö–ê–Ñ–¢–¨–°–Ø */
.ai-chat-messages {
    width: 100%;
    max-height: 50vh;
    overflow-y: auto;
    overflow-x: hidden;
    background: var(--color-bg, #ffffff);
    border: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
    border-radius: 30px 30px 0 0;
    border-bottom: none;
    padding: 12px;
    padding-bottom: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    gap: 12px;

    /* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ stacking context –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ z-index */
    position: relative;
    z-index: 1;

    /* Performance optimization */
    contain: layout style paint;
    will-change: scroll-position;

    /* Smooth scrolling –Ω–∞ –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö */
    scroll-behavior: smooth;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è Firefox scrollbar */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

/* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤ –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ gap */
@supports not (gap: 12px) {
    .ai-chat-messages>*+* {
        margin-top: 12px;
    }
}

[data-theme="dark"] .ai-chat-messages {
    background: #171717;
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    /* Firefox scrollbar –¥–ª—è —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏ */
    scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-messages {
        background: #171717;
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        /* Firefox scrollbar –¥–ª—è —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏ */
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
    }
}

/* Custom scrollbar */
.ai-chat-messages::-webkit-scrollbar {
    width: 6px;
}

.ai-chat-messages::-webkit-scrollbar-track {
    background: transparent;
}

.ai-chat-messages::-webkit-scrollbar-thumb {
    background: var(--color-border, rgba(0, 0, 0, 0.1));
    border-radius: 3px;
}

.ai-chat-messages::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-light, rgba(0, 0, 0, 0.3));
}

/* ========================================
   CHAT MESSAGES
   ======================================== */

.ai-message {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    animation: fadeInUp 0.3s ease;

    /* Performance optimization */
    will-change: transform, opacity;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è subpixel rendering */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

/* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤ –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ gap */
@supports not (gap: 10px) {
    .ai-message {
        gap: 0;
    }

    .ai-message>*+* {
        margin-left: 10px;
    }

    .ai-message--user>*+* {
        margin-left: 0;
        margin-right: 10px;
    }
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.ai-message--user {
    flex-direction: row-reverse;
}

.ai-message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    line-height: 1;
    /* –Ø–≤–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –¥–ª—è –æ–¥–Ω–∞–∫–æ–≤–æ—ó –≤–∏—Å–æ—Ç–∏ —Ä—è–¥–∫–∞ */
    flex-shrink: 0;
    background: var(--color-bg-gray, #f5f5f5);

    /* –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ emoji –Ω–∞ –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö */
    font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;

    /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥–µ—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–∏ —Ä—ñ–∑–Ω–∏—Ö —Ä–æ–∑–º—ñ—Ä–∞—Ö —à—Ä–∏—Ñ—Ç—É —Å–∏—Å—Ç–µ–º–∏ */
    -webkit-text-size-adjust: none;
    text-size-adjust: none;
}

.ai-message--user .ai-message-avatar {
    background: #E50914;
    color: white;
}

.ai-message-content {
    flex: 1;
    background: var(--color-bg-gray, #f5f5f5);
    padding: 10px 14px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.5;
    /* –í—ñ–¥–Ω–æ—Å–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –û–ö –¥–ª—è —Ç–µ–∫—Å—Ç—É */
    color: var(--color-text, #1a1a1a);

    /* –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π word breaking –Ω–∞ –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö */
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-word;

    /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—é */
    min-width: 0;

    /* Hyphens –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è */
    hyphens: auto;
    -webkit-hyphens: auto;
    -moz-hyphens: auto;
}

.ai-message--user .ai-message-content {
    background: #E50914;
    color: white;
}

.ai-message-content p {
    margin: 0;
}

.ai-message-content p+p {
    margin-top: 8px;
}

/* ========================================
   CHAT INPUT
   ======================================== */

.ai-chat-input-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    background: var(--color-bg, #ffffff);
    border: 2px solid var(--color-border, rgba(0, 0, 0, 0.1));
    border-radius: 24px;
    padding: 6px 8px 6px 16px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);

    /* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ stacking context */
    position: relative;
    z-index: 2;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è border-radius clipping –≤ Safari */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
}

/* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤ –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ gap */
@supports not (gap: 8px) {
    .ai-chat-input-wrapper {
        gap: 0;
    }

    .ai-chat-input-wrapper>*+* {
        margin-left: 8px;
    }
}

/* –ö–æ–ª–∏ —î —ñ—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—É - —ñ–Ω–ø—É—Ç –ø—Ä–∏—î–¥–Ω—É—î—Ç—å—Å—è –∑–Ω–∏–∑—É */
.ai-chat-inline:has(.ai-chat-messages[style*="display: flex"]) .ai-chat-input-wrapper {
    border-radius: 0 0 12px 12px;
    border-top: none;
}

/* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤ –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ :has() */
@supports not (selector(:has(*))) {
    .ai-chat-input-wrapper.has-history {
        border-radius: 0 0 12px 12px;
        border-top: none;
    }
}

.ai-chat-input-wrapper:focus-within {
    border-color: #E50914;
    box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.1);
}

[data-theme="dark"] .ai-chat-input-wrapper {
    background: #171717;
    border-color: rgba(255, 255, 255, 0.2);
}

@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-input-wrapper {
        background: #171717;
        border-color: rgba(255, 255, 255, 0.2);
    }
}

.ai-chat-input {
    flex: 1;
    border: none;
    border-radius: 30px;
    background: transparent;
    outline: none;
    font-size: 12px;
    color: var(--color-text, #1a1a1a);
    padding: 6px 0;
    min-height: 30px;
}

.ai-chat-input::placeholder {
    color: var(--color-text-light, rgba(0, 0, 0, 0.5));
}

.ai-chat-send-btn,
.ai-chat-detach-btn,
.ai-chat-close-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--color-text, #1a1a1a);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.2s ease;
    flex-shrink: 0;
    padding: 0;
}

.ai-chat-send-btn img {
    width: 22px;
    height: 22px;
    object-fit: contain;
    display: block;

    /* –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π image rendering –Ω–∞ –≤—Å—ñ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;

    /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥–µ—Ñ–æ—Ä–º–∞—Ü—ñ—ó */
    flex-shrink: 0;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è Retina –¥–∏—Å–ø–ª–µ—ó–≤ */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

.ai-chat-send-btn:hover {
    transform: scale(1.1);
    -webkit-transform: scale(1.1);
    /* Transform origin –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è */
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

.ai-chat-send-btn:active {
    transform: scale(0.95);
    -webkit-transform: scale(0.95);
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

.ai-chat-detach-btn svg,
.ai-chat-close-btn svg {
    width: 18px;
    height: 18px;
    /* display: inline-block - –¥–µ—Ñ–æ–ª—Ç–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ SVG, –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î–º–æ */
    /* pointer-events –≤–∏–¥–∞–ª–µ–Ω–æ - –¥–æ–∑–≤–æ–ª—è—î–º–æ –ø—Ä–∏—Ä–æ–¥–Ω—é –æ–±—Ä–æ–±–∫—É –ø–æ–¥—ñ–π */
    flex-shrink: 0;
}

/* –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ inline –∞—Ç—Ä–∏–±—É—Ç–∏ —á–µ—Ä–µ–∑ !important –¥–ª—è –∫—Ä–æ—Å-–±—Ä–∞—É–∑–µ—Ä–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ */
.ai-chat-detach-btn svg *,
.ai-chat-close-btn svg * {
    /* –ü—Ä–∏–º—É—Å–æ–≤–æ —Å–∫–∏–¥–∞—î–º–æ fill —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —á–æ—Ä–Ω–æ–≥–æ */
    fill: none;
}

.ai-chat-detach-btn:hover,
.ai-chat-close-btn:hover {
    transform: scale(1.1);
    -webkit-transform: scale(1.1);
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

.ai-chat-detach-btn:active,
.ai-chat-close-btn:active {
    transform: scale(0.95);
    -webkit-transform: scale(0.95);
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

/* –¢–µ–º–∏ –¥–ª—è —ñ–∫–æ–Ω–æ–∫ - –í–ò–ü–†–ê–í–õ–ï–ù–û –∑ fallback —Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—é —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ—Å—Ç—é */

/* –î–µ—Ñ–æ–ª—Ç–Ω–∞ —Ç–µ–º–∞ (–∫–æ–ª–∏ data-theme –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ) - —Å–≤—ñ—Ç–ª–∞ */
.ai-chat-detach-btn svg,
.ai-chat-close-btn svg {
    stroke: #1a1a1a;
    color: #1a1a1a;
    /* fallback –¥–ª—è currentColor */
}

.ai-chat-detach-btn svg *,
.ai-chat-close-btn svg * {
    stroke: inherit;
}

/* –ï–∫—Å–ø–ª—ñ—Ü–∏—Ç–Ω–∞ —Å–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
[data-theme="light"] .ai-chat-detach-btn svg,
[data-theme="light"] .ai-chat-close-btn svg {
    stroke: #1a1a1a;
    color: #1a1a1a;
}

[data-theme="light"] .ai-chat-detach-btn svg *,
[data-theme="light"] .ai-chat-close-btn svg * {
    stroke: inherit;
}

/* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
[data-theme="dark"] .ai-chat-detach-btn svg,
[data-theme="dark"] .ai-chat-close-btn svg {
    stroke: #ffffff;
    color: #ffffff;
}

[data-theme="dark"] .ai-chat-detach-btn svg *,
[data-theme="dark"] .ai-chat-close-btn svg * {
    stroke: inherit;
}

/* Auto —Ç–µ–º–∞ –∑ —Ç–µ–º–Ω–∏–º prefers-color-scheme */
@media (prefers-color-scheme: dark) {

    [data-theme="auto"] .ai-chat-detach-btn svg,
    [data-theme="auto"] .ai-chat-close-btn svg {
        stroke: #ffffff;
        color: #ffffff;
    }

    [data-theme="auto"] .ai-chat-detach-btn svg *,
    [data-theme="auto"] .ai-chat-close-btn svg * {
        stroke: inherit;
    }
}

/* Auto —Ç–µ–º–∞ –∑—ñ —Å–≤—ñ—Ç–ª–∏–º prefers-color-scheme (fallback) */
@media (prefers-color-scheme: light) {

    [data-theme="auto"] .ai-chat-detach-btn svg,
    [data-theme="auto"] .ai-chat-close-btn svg {
        stroke: #1a1a1a;
        color: #1a1a1a;
    }

    [data-theme="auto"] .ai-chat-detach-btn svg *,
    [data-theme="auto"] .ai-chat-close-btn svg * {
        stroke: inherit;
    }
}

/* –•–æ–≤–µ—Ä —Ñ–æ–Ω–∏ - –í–ò–ü–†–ê–í–õ–ï–ù–û –∑ –¥–µ—Ñ–æ–ª—Ç–Ω–æ—é —Ç–µ–º–æ—é */

/* –î–µ—Ñ–æ–ª—Ç–Ω–∏–π —Ö–æ–≤–µ—Ä (—Å–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞) */
.ai-chat-detach-btn:hover,
.ai-chat-close-btn:hover {
    background: rgba(0, 0, 0, 0.05);
}

/* –ï–∫—Å–ø–ª—ñ—Ü–∏—Ç–Ω–∞ —Å–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
[data-theme="light"] .ai-chat-detach-btn:hover,
[data-theme="light"] .ai-chat-close-btn:hover {
    background: rgba(0, 0, 0, 0.05);
}

/* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
[data-theme="dark"] .ai-chat-detach-btn:hover,
[data-theme="dark"] .ai-chat-close-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* Auto —Ç–µ–º–∞ –∑ —Ç–µ–º–Ω–∏–º prefers-color-scheme */
@media (prefers-color-scheme: dark) {

    [data-theme="auto"] .ai-chat-detach-btn:hover,
    [data-theme="auto"] .ai-chat-close-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }
}

/* Auto —Ç–µ–º–∞ –∑—ñ —Å–≤—ñ—Ç–ª–∏–º prefers-color-scheme */
@media (prefers-color-scheme: light) {

    [data-theme="auto"] .ai-chat-detach-btn:hover,
    [data-theme="auto"] .ai-chat-close-btn:hover {
        background: rgba(0, 0, 0, 0.05);
    }
}

/* ========================================
   DETACHED MODAL
   ======================================== */

.ai-chat-modal {
    position: fixed;
    width: 400px;
    max-height: 50vh;
    min-height: 200px;
    background: var(--color-bg, #ffffff);
    border: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    resize: vertical;

    /* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ stacking context */
    isolation: isolate;

    /* Performance optimization */
    contain: layout style paint;
    will-change: transform;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è position: fixed blur –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –µ–∫—Ä–∞–Ω–∞—Ö */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-perspective: 1000px;
    perspective: 1000px;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è Retina –¥–∏—Å–ø–ª–µ—ó–≤ */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
}

[data-theme="dark"] .ai-chat-modal {
    background: #171717;
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-modal {
        background: #171717;
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }
}

/* Modal Header */
.ai-chat-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
    cursor: move;
    /* Fallback cursor */
    cursor: -webkit-grab;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;

    /* Touch device */
    touch-action: none;
}

.ai-chat-modal-header:active {
    cursor: -webkit-grabbing;
    cursor: grabbing;
}

.ai-chat-modal-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--color-text, #1a1a1a);
    margin: 0;
}

.ai-chat-modal-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: var(--color-text, #1a1a1a);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s ease;
}

.ai-chat-modal-close svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
}

/* –ü—Ä–∏–º—É—Å–æ–≤–æ —Å–∫–∏–¥–∞—î–º–æ fill */
.ai-chat-modal-close svg * {
    fill: none;
}

.ai-chat-modal-close:hover {
    background: var(--color-bg-gray, #f5f5f5);
}

/* –¢–µ–º–∏ –¥–ª—è modal close button —ñ–∫–æ–Ω–æ–∫ */

/* –î–µ—Ñ–æ–ª—Ç–Ω–∞ —Ç–µ–º–∞ (—Å–≤—ñ—Ç–ª–∞) */
.ai-chat-modal-close svg {
    stroke: #1a1a1a;
    color: #1a1a1a;
}

.ai-chat-modal-close svg * {
    stroke: inherit;
}

/* –ï–∫—Å–ø–ª—ñ—Ü–∏—Ç–Ω–∞ —Å–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞ */
[data-theme="light"] .ai-chat-modal-close svg {
    stroke: #1a1a1a;
    color: #1a1a1a;
}

[data-theme="light"] .ai-chat-modal-close svg * {
    stroke: inherit;
}

/* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
[data-theme="dark"] .ai-chat-modal-close svg {
    stroke: #ffffff;
    color: #ffffff;
}

[data-theme="dark"] .ai-chat-modal-close svg * {
    stroke: inherit;
}

/* Auto —Ç–µ–º–∞ –∑ —Ç–µ–º–Ω–∏–º prefers-color-scheme */
@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-modal-close svg {
        stroke: #ffffff;
        color: #ffffff;
    }

    [data-theme="auto"] .ai-chat-modal-close svg * {
        stroke: inherit;
    }
}

/* Auto —Ç–µ–º–∞ –∑—ñ —Å–≤—ñ—Ç–ª–∏–º prefers-color-scheme */
@media (prefers-color-scheme: light) {
    [data-theme="auto"] .ai-chat-modal-close svg {
        stroke: #1a1a1a;
        color: #1a1a1a;
    }

    [data-theme="auto"] .ai-chat-modal-close svg * {
        stroke: inherit;
    }
}

/* Modal Messages */
.ai-chat-modal-messages {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;

    /* Performance optimization */
    contain: layout style paint;
    will-change: scroll-position;

    /* Smooth scrolling */
    scroll-behavior: smooth;

    /* Firefox scrollbar */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

/* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤ –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ gap */
@supports not (gap: 12px) {
    .ai-chat-modal-messages>*+* {
        margin-top: 12px;
    }
}

.ai-chat-modal-messages::-webkit-scrollbar {
    width: 6px;
}

.ai-chat-modal-messages::-webkit-scrollbar-track {
    background: transparent;
}

.ai-chat-modal-messages::-webkit-scrollbar-thumb {
    background: var(--color-border, rgba(0, 0, 0, 0.1));
    border-radius: 3px;
}

.ai-chat-modal-messages::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-light, rgba(0, 0, 0, 0.3));
}

/* Firefox scrollbar –¥–ª—è —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏ modal */
[data-theme="dark"] .ai-chat-modal-messages {
    scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-modal-messages {
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
    }
}

/* Modal Input */
.ai-chat-modal-input-wrapper {
    padding: 16px 20px;
    border-top: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä—ñ–≤ –±–µ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ gap */
@supports not (gap: 8px) {
    .ai-chat-modal-input-wrapper {
        gap: 0;
    }

    .ai-chat-modal-input-wrapper>*+* {
        margin-left: 8px;
    }
}

.ai-chat-modal-input {
    flex: 1;
    border: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
    background: var(--color-bg, #ffffff);
    outline: none;
    font-size: 14px;
    color: var(--color-text, #1a1a1a);
    padding: 10px 14px;
    border-radius: 20px;
    min-height: 38px;
    transition: border-color 0.2s ease;
}

.ai-chat-modal-input:focus {
    border-color: #E50914;
}

.ai-chat-modal-send {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: transparent;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.2s ease;
    padding: 0;
}

.ai-chat-modal-send:hover {
    transform: scale(1.1);
    -webkit-transform: scale(1.1);
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

.ai-chat-modal-send:active {
    transform: scale(0.95);
    -webkit-transform: scale(0.95);
    transform-origin: center center;
    -webkit-transform-origin: center center;
}

.ai-chat-modal-send img {
    width: 22px;
    height: 22px;
    object-fit: contain;
    display: block;

    /* –£–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π image rendering */
    image-rendering: -webkit-optimize-contrast;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;

    flex-shrink: 0;

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è Retina */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

/* Resize handle */
.ai-chat-modal-resize {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 20px;
    height: 20px;
    cursor: se-resize;
    /* Fallback cursor */
    cursor: nwse-resize;
    background: linear-gradient(135deg, transparent 50%, var(--color-border, rgba(0, 0, 0, 0.1)) 50%);

    /* –ó–±—ñ–ª—å—à–µ–Ω–∞ –∑–æ–Ω–∞ –¥–ª—è –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è */
    z-index: 10;

    /* Touch device */
    touch-action: none;
}

/* ========================================
   RESPONSIVE
   ======================================== */

/* –ü–ª–∞–Ω—à–µ—Ç–∏ */
@media (max-width: 1024px) {
    .header-actions-wrapper {
        display: none;
    }

    .ai-chat-inline {
        width: 280px;
    }

    .ai-chat-modal {
        width: 90vw;
        max-width: 400px;
    }
}

/* –ú–æ–±—ñ–ª—å–Ω—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó */
@media (max-width: 767px) {
    .ai-chat-inline {
        width: 100%;
        position: relative;
        transform: none;
        left: auto;
        right: auto;
    }

    .ai-chat-messages {
        max-height: 40vh;
        border-radius: 20px 20px 0 0;
    }

    .ai-chat-input-wrapper {
        border-radius: 20px;
        padding: 4px 6px 4px 12px;
    }

    .ai-chat-inline:has(.ai-chat-messages[style*="display: flex"]) .ai-chat-input-wrapper {
        border-radius: 0 0 8px 8px;
    }

    .ai-chat-send-btn,
    .ai-chat-detach-btn,
    .ai-chat-close-btn {
        width: 32px;
        height: 32px;
        /* –ó–±—ñ–ª—å—à—É—î–º–æ –∑–æ–Ω—É –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –¥–ª—è touch */
        min-width: 44px;
        min-height: 44px;
    }

    .ai-chat-modal {
        width: 95vw;
        max-height: 70vh;
        border-radius: 12px;
    }

    .ai-chat-modal-header {
        padding: 12px 16px;
    }

    .ai-chat-modal-input-wrapper {
        padding: 12px 16px;
    }
}

/* iOS Safari —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è */
@supports (-webkit-touch-callout: none) {

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è SVG –≤ iOS Safari */
    .ai-chat-detach-btn svg,
    .ai-chat-close-btn svg,
    .ai-chat-modal-close svg {
        /* –ü—Ä–∏–º—É—Å–æ–≤–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è SVG */
        display: inline-block;
        vertical-align: middle;
        /* –í–∏–º–∫–Ω–µ–Ω–Ω—è hardware acceleration –¥–ª—è –±—ñ–ª—å—à–æ—ó —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∞–º –∑ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º */
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        -webkit-perspective: 1000;
        perspective: 1000;
    }

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è stroke –≤ iOS Safari */
    .ai-chat-detach-btn svg path,
    .ai-chat-detach-btn svg line,
    .ai-chat-close-btn svg path,
    .ai-chat-close-btn svg line,
    .ai-chat-modal-close svg path,
    .ai-chat-modal-close svg line {
        /* –ü—Ä–∏–º—É—Å–æ–≤–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è stroke */
        vector-effect: non-scaling-stroke;
        stroke: inherit;
        -webkit-stroke: inherit;
    }

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è touch events –≤ iOS */
    .ai-chat-send-btn,
    .ai-chat-detach-btn,
    .ai-chat-close-btn,
    .ai-chat-modal-close {
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0.05);
        -webkit-user-select: none;
        user-select: none;
        /* –ó–±—ñ–ª—å—à–µ–Ω–∞ –∑–æ–Ω–∞ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –¥–ª—è iOS */
        position: relative;
    }

    .ai-chat-send-btn::after,
    .ai-chat-detach-btn::after,
    .ai-chat-close-btn::after,
    .ai-chat-modal-close::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        min-width: 44px;
        min-height: 44px;
        width: calc(100% + 8px);
        height: calc(100% + 8px);
    }

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è input –¥–ª—è iOS */
    .ai-chat-input,
    .ai-chat-modal-input {
        -webkit-appearance: none;
        appearance: none;
        /* –í–∏–º–∫–Ω–µ–Ω–Ω—è –∞–≤—Ç–æ–∑—É–º—É –≤ iOS Safari */
        font-size: 16px;
        /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –∑ –∫—É—Ä—Å–æ—Ä–æ–º */
        -webkit-user-select: text;
        user-select: text;
    }

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è modal –Ω–∞ iOS */
    .ai-chat-modal {
        /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∞–º –∑ position: fixed */
        -webkit-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
    }

    /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è scroll –¥–ª—è iOS */
    .ai-chat-messages,
    .ai-chat-modal-messages {
        -webkit-overflow-scrolling: touch;
        /* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è rubber band effect */
        overscroll-behavior: contain;
    }

    /* iOS - Mobile (max-width: 767px) */
    @media (max-width: 767px) {
        .ai-chat-modal {
            width: 95vw;
            border-radius: 12px;
        }

        .ai-chat-messages {
            max-height: 40vh;
            border-radius: 20px 20px 0 0;
        }
    }
}

/* –ú–∞–ª—ñ –º–æ–±—ñ–ª—å–Ω—ñ –µ–∫—Ä–∞–Ω–∏ */
@media (max-width: 767px) {
    .ai-chat-inline {
        width: 100%;
    }

    .ai-chat-messages {
        max-height: 35vh;
        padding: 8px;
        border-radius: 16px 16px 0 0;
    }

    .ai-chat-input {
        font-size: 16px;
        /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∞–≤—Ç–æ–∑—É–º—É –≤ iOS */
    }

    .ai-chat-modal {
        width: 100vw;
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
        top: 0;
        left: 0;
    }

    .ai-chat-modal-messages {
        padding: 12px;
    }

    .ai-message-avatar {
        width: 28px;
        height: 28px;
        font-size: 16px;
    }

    .ai-message-content {
        font-size: 13px;
        padding: 8px 12px;
    }
}

/* ========================================
   ACCESSIBILITY
   ======================================== */

.ai-chat-input:focus-visible,
.ai-chat-send-btn:focus-visible,
.ai-chat-detach-btn:focus-visible,
.ai-chat-close-btn:focus-visible,
.ai-chat-modal-input:focus-visible,
.ai-chat-modal-send:focus-visible,
.ai-chat-modal-close:focus-visible {
    outline: 2px solid #E50914;
    outline-offset: 2px;
}

@media (prefers-reduced-motion: reduce) {
    .ai-message {
        animation: none;
    }

    .ai-chat-input-wrapper,
    .ai-chat-send-btn,
    .ai-chat-detach-btn,
    .ai-chat-close-btn,
    .ai-chat-modal-close,
    .ai-chat-modal-send {
        transition: none;
    }
}

/* ========================================
   –¢–ò–ú–ß–ê–°–û–í–û: AI –ü–û–ú–Ü–ß–ù–ò–ö - –ù–ï–ó–ê–ë–ê–†–û–ú
   ======================================== */

/* –ë–∞–∑–æ–≤—ñ —Å—Ç–∏–ª—ñ - —á–∏—Å—Ç–µ –º–∞—Ç–æ–≤–µ —Å–∫–ª–æ */
.ai-chat-inline.coming-soon .ai-chat-input-wrapper {
    position: relative;
    pointer-events: none;
    cursor: not-allowed;
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
[data-theme="dark"] .ai-chat-inline.coming-soon .ai-chat-input-wrapper {
    background: rgba(23, 23, 23, 0.85);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Auto —Ç–µ–º–∞ –∑ —Ç–µ–º–Ω–∏–º prefers-color-scheme */
@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-inline.coming-soon .ai-chat-input-wrapper {
        background: rgba(23, 23, 23, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
}

/* –¢–µ–∫—Å—Ç "AI –ø–æ–º—ñ—á–Ω–∏–∫ - –Ω–µ–∑–∞–±–∞—Ä–æ–º" */
.ai-chat-inline.coming-soon .ai-chat-input-wrapper::before {
    content: 'AI –ø–æ–º—ñ—á–Ω–∏–∫ - –Ω–µ–∑–∞–±–∞—Ä–æ–º';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 13px;
    font-weight: 600;
    color: #1a1a1a;
    white-space: nowrap;
    z-index: 10;
    pointer-events: none;
    letter-spacing: 0.3px;
}

/* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ –¥–ª—è —Ç–µ–∫—Å—Ç—É */
[data-theme="dark"] .ai-chat-inline.coming-soon .ai-chat-input-wrapper::before {
    color: rgba(255, 255, 255, 0.95);
}

@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .ai-chat-inline.coming-soon .ai-chat-input-wrapper::before {
        color: rgba(255, 255, 255, 0.95);
    }
}

/* –ó–∞—Ç—É—à–æ–≤—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ */
.ai-chat-inline.coming-soon .ai-chat-input,
.ai-chat-inline.coming-soon .ai-chat-send-btn,
.ai-chat-inline.coming-soon .ai-chat-detach-btn,
.ai-chat-inline.coming-soon .ai-chat-close-btn {
    opacity: 0;
    pointer-events: none;
    cursor: not-allowed;
}

/* Responsive –¥–ª—è mobile */
@media (max-width: 767px) {
    .ai-chat-inline.coming-soon .ai-chat-input-wrapper::before {
        font-size: 11px;
    }
}

@media (max-width: 767px) {
    .ai-chat-inline.coming-soon .ai-chat-input-wrapper::before {
        font-size: 10px;
    }
}