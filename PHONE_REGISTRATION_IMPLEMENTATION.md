# üì± –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É

## ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

### 1. üîß –ú–æ–¥–µ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (`apps/accounts/models.py`)
- **–î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `phone_registered_at`** –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥–∞—Ç–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω
- **–ó—Ä–æ–±–ª–µ–Ω–æ email —Ç–∞ phone nullable** –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ
- **–î–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥–∏:**
  - `days_since_phone_registration` - –¥–Ω—ñ –∑ –º–æ–º–µ–Ω—Ç—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω
  - `phone_registration_expired` - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è 3-–¥–µ–Ω–Ω–∏–π –ø–µ—Ä—ñ–æ–¥
  - `needs_email_verification` - —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ email

### 2. üìù –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó (`apps/accounts/forms.py`)
- **–û–Ω–æ–≤–ª–µ–Ω–æ `CustomUserCreationForm`** –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- **–î–æ–¥–∞–Ω–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é:** –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π email –ê–ë–û —Ç–µ–ª–µ—Ñ–æ–Ω
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è** –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É (+380)
- **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ** email —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- **–î–æ–¥–∞–Ω–æ `AddEmailForm`** –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è email –¥–æ phone-only –∞–∫–∞—É–Ω—Ç—ñ–≤

### 3. üîê –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (`apps/accounts/backends.py`)
- **–†–æ–∑—à–∏—Ä–µ–Ω–æ `EmailBackend`** –¥–ª—è –≤—Ö–æ–¥—É —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω
- **–î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É** –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è 3-–¥–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
- **–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤—Ö–æ–¥—É** —è–∫—â–æ –ø–µ—Ä—ñ–æ–¥ –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è —ñ email –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏–π

### 4. üõ°Ô∏è Middleware (`playvision/middleware.py`)
- **–ù–æ–≤–∏–π `PhoneRegistrationMiddleware`**
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π logout** –ø—ñ—Å–ª—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è 3-–¥–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É
- **–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è** –ø—Ä–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è email —É –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ
- **–ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –¥–Ω—ñ–≤** —â–æ –∑–∞–ª–∏—à–∏–ª–∏—Å—å

### 5. üìß Email —Å–µ—Ä–≤—ñ—Å (`apps/accounts/services.py`)
- **`EmailService`** –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–¥—ñ–≤ —á–µ—Ä–µ–∑ Gmail
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è** 6-–∑–Ω–∞—á–Ω–∏—Ö –∫–æ–¥—ñ–≤
- **HTML-—à–∞–±–ª–æ–Ω–∏** –¥–ª—è email –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** –≤—ñ–¥–ø—Ä–∞–≤–∫–∏

### 6. üé® View —Ç–∞ URL
- **`AddEmailView`** - –¥–æ–¥–∞–≤–∞–Ω–Ω—è email –¥–æ phone-only –∞–∫–∞—É–Ω—Ç—ñ–≤
- **`VerifyEmailFormView`** - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email –∫–æ–¥–æ–º
- **–û–Ω–æ–≤–ª–µ–Ω–æ `RegisterView`** –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞–º–∏
- **–î–æ–¥–∞–Ω–æ URL** –¥–ª—è –Ω–æ–≤–∏—Ö views

### 7. üé® –®–∞–±–ª–æ–Ω–∏
- **`add_email.html`** - —Ñ–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è email
- **`verify_email_form.html`** - —Ñ–æ—Ä–º–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è email
- **–û–Ω–æ–≤–ª–µ–Ω–æ `dashboard.html`** –∑ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è–º –ø—Ä–æ email
- **CSS —Å—Ç–∏–ª—ñ** –¥–ª—è warning –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

### 8. ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- **–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ Gmail SMTP** –≤ settings
- **–î–æ–¥–∞–Ω–æ middleware** –¥–æ MIDDLEWARE
- **–°—Ç–≤–æ—Ä–µ–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—é** –¥–ª—è –Ω–æ–≤–∏—Ö –ø–æ–ª—ñ–≤

---

## üöÄ –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω:
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É –∑ –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É (–±–µ–∑ email)
2. –°–∏—Å—Ç–µ–º–∞ —Å—Ç–≤–æ—Ä—é—î –∞–∫–∞—É–Ω—Ç –∑ `phone_registered_at = now()`
3. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—Ç—Ä–∏–º—É—î 3-–¥–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø

### 3-–¥–µ–Ω–Ω–∏–π –ª—ñ–º—ñ—Ç:
1. **Middleware** –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Ç
2. –Ø–∫—â–æ –ø—Ä–æ–π—à–ª–æ 3 –¥–Ω—ñ —ñ email –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏–π ‚Üí **logout + redirect**
3. –ü–æ–∫–∞–∑—É—î –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è email

### –î–æ–¥–∞–≤–∞–Ω–Ω—è email:
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –π–¥–µ –≤ **–î–æ–¥–∞—Ç–∏ Email** (`/auth/add-email/`)
2. –í–≤–æ–¥–∏—Ç—å email ‚Üí —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –∫–æ–¥ –Ω–∞ –ø–æ—à—Ç—É
3. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –∫–æ–¥ ‚Üí `is_email_verified = True`, `phone_registered_at = None`

### –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è:
- **–í –¥–∞—à–±–æ—Ä–¥—ñ** –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∂–æ–≤—Ç–∏–π –±–ª–æ–∫ –∑ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è–º
- **–í middleware** –¥–æ–¥–∞—î—Ç—å—Å—è warning message
- **–ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –¥–Ω—ñ–≤** —â–æ –∑–∞–ª–∏—à–∏–ª–∏—Å—å

---

## üìã –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Gmail

–î–∏–≤—ñ—Ç—å—Å—è —Ñ–∞–π–ª `EMAIL_SETUP.md` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π.

–ö–æ—Ä–æ—Ç–∫–æ:
1. –£–≤—ñ–º–∫–Ω—É—Ç–∏ 2FA —É Gmail
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ App Password
3. –î–æ–¥–∞—Ç–∏ –≤ `.env`:
```bash
EMAIL_HOST_USER=your-gmail@gmail.com
EMAIL_HOST_PASSWORD=your-16-char-app-password
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/auth/register/`
2. –û–±—Ä–∞—Ç–∏ —Ç–∞–± "–¢–µ–ª–µ—Ñ–æ–Ω"
3. –í–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: 501234567)
4. –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –î–æ–¥–∞–≤–∞–Ω–Ω—è email
1. –í –¥–∞—à–±–æ—Ä–¥—ñ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ "–î–æ–¥–∞—Ç–∏ Email"
2. –í–≤–µ—Å—Ç–∏ email –∞–¥—Ä–µ—Å—É
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—à—Ç—É —Ç–∞ –≤–≤–µ—Å—Ç–∏ –∫–æ–¥
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏–π, –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑–Ω–∏–∫–ª–∏

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ó–∞–∫—ñ–Ω—á–µ–Ω–Ω—è –ø–µ—Ä—ñ–æ–¥—É
1. –í –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ `phone_registered_at` –Ω–∞ 4 –¥–Ω—ñ –Ω–∞–∑–∞–¥
2. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–∞–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π logout –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º

---

## ‚ú® –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó

- ‚úÖ **–ë–µ–∑ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤** –∑ —ñ—Å–Ω—É—é—á–∏–º –∫–æ–¥–æ–º
- ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∏–π** —ñ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π –∫–æ–¥
- ‚úÖ **–ë–µ–∑ inline —Å—Ç–∏–ª—ñ–≤** - –≤—Å–µ –≤ CSS —Ñ–∞–π–ª–∞—Ö
- ‚úÖ **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–∞—è–≤–Ω–æ–≥–æ –∫–æ–¥—É** –∑–∞–º—ñ—Å—Ç—å –¥—É–±–ª—é–≤–∞–Ω–Ω—è
- ‚úÖ **Backwards compatible** - —Å—Ç–∞—Ä—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏
- ‚úÖ **–ë–µ–∑–ø–µ—á–Ω–æ** - –≤—Å—ñ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ –º—ñ—Å—Ü—ñ
- ‚úÖ **UX-friendly** - –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é

---

## üéØ –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è!

–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Gmail —Å–∏—Å—Ç–µ–º–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–º–æ–∂—É—Ç—å —Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω, –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ 3-–¥–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø —ñ –¥–æ–¥–∞–≤–∞—Ç–∏ email –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
