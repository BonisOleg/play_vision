# üìßüì± –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

## ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –∫–æ–¥ –¥–ª—è –æ–±–æ—Ö —Ç–∏–ø—ñ–≤ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó

### üîÑ **–õ–æ–≥—ñ–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —Ç–µ–ø–µ—Ä –æ–¥–Ω–∞–∫–æ–≤–∞ –¥–ª—è EMAIL —Ç–∞ PHONE**

#### 1. **Email —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î email + –ø–∞—Ä–æ–ª—å
- –°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –∫–æ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –Ω–∞ email
- –ü—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è - –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø

#### 2. **Phone —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è:**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î —Ç–µ–ª–µ—Ñ–æ–Ω + –ø–∞—Ä–æ–ª—å  
- –°–∏—Å—Ç–µ–º–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `phone_registered_at = now()`
- 3-–¥–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø + –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∏ email

---

## üõ†Ô∏è **–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**

### 1. **RegisterView** - —î–¥–∏–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤
```python
def handle_verification(self):
    if self.object.email and not self.object.phone_registered_at:
        # Email registration - send verification code
        EmailService.send_email_verification_code(self.object)
    elif self.object.phone_registered_at:
        # Phone registration - show reminder
        messages.warning('–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–¥–∞—Ç–∏ email!')
```

### 2. **PhoneRegistrationMiddleware** - —Ç—ñ–ª—å–∫–∏ –¥–ª—è phone-only
- –î—ñ—î **–¢–Ü–õ–¨–ö–ò** –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑ `phone_registered_at`
- –ù–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î 3-–¥–µ–Ω–Ω–∏–π –ª—ñ–º—ñ—Ç
- –ü–æ–∫–∞–∑—É—î –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –Ω–∞ –∫–ª—é—á–æ–≤–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö

### 3. **EmailBackend** - –ø—ñ–¥—Ç—Ä–∏–º—É—î –æ–±–∏–¥–≤–∞ —Ç–∏–ø–∏
- –í—Ö—ñ–¥ —á–µ—Ä–µ–∑ email, phone –∞–±–æ username
- –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è phone-only –∑ expired –ø–µ—Ä—ñ–æ–¥–æ–º

### 4. **VerifyEmailFormView** - —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π
- –ü—Ä–∞—Ü—é—î –¥–ª—è –æ–±–æ—Ö —Ç–∏–ø—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –†—ñ–∑–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–±–∏—Ä–∞—î `phone_registered_at` –ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è

---

## üé® **UI/UX –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ**

### **Phone-only –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ:**
- ‚ö†Ô∏è **–ñ–æ–≤—Ç–∏–π warning** –≤ –¥–∞—à–±–æ—Ä–¥—ñ –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º –¥–Ω—ñ–≤
- –ö–Ω–æ–ø–∫–∞ "–î–æ–¥–∞—Ç–∏ Email" ‚Üí —Ñ–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è email
- –ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è ‚Üí —Ñ–æ—Ä–º–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫–æ–¥—É

### **Email –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ:**
- üìß **–°–∏–Ω—ñ–π info** –≤ –¥–∞—à–±–æ—Ä–¥—ñ –ø—Ä–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
- –ö–Ω–æ–ø–∫–∏ "–í–≤–µ—Å—Ç–∏ –∫–æ–¥" —Ç–∞ "–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–æ–≤–∏–π –∫–æ–¥"
- –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è

---

## üìä **–°—Ç–∞–Ω–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**

| –°—Ü–µ–Ω–∞—Ä—ñ–π | phone_registered_at | is_email_verified | –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ |
|----------|---------------------|-------------------|-----------|
| **Email —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è** | `null` | `false` | –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ email |
| **Email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏–π** | `null` | `true` | –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø |
| **Phone —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è** | `datetime` | `false` | 3-–¥–µ–Ω–Ω–∏–π –ª—ñ–º—ñ—Ç + –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è |
| **Phone + email –¥–æ–¥–∞–Ω–æ** | `null` | `true` | –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø |
| **Phone expired** | `datetime` | `false` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π logout |

---

## üîÑ **–ü–æ—Ç—ñ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**

### **Email —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è:**
1. `/auth/register/` ‚Üí —Ç–∞–± "Email"
2. –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ email + –ø–∞—Ä–æ–ª—å
3. Auto-login + –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ email"
4. Email –∑ –∫–æ–¥–æ–º ‚Üí `/auth/verify-email/` 
5. –í–≤–µ—Å—Ç–∏ –∫–æ–¥ ‚Üí –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø

### **Phone —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è:**
1. `/auth/register/` ‚Üí —Ç–∞–± "–¢–µ–ª–µ—Ñ–æ–Ω"
2. –ó–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω + –ø–∞—Ä–æ–ª—å
3. Auto-login + 3-–¥–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø
4. –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –≤ –¥–∞—à–±–æ—Ä–¥—ñ ‚Üí `/auth/add-email/`
5. –î–æ–¥–∞—Ç–∏ email ‚Üí `/auth/verify-email-form/`
6. –í–≤–µ—Å—Ç–∏ –∫–æ–¥ ‚Üí –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø

---

## ‚öôÔ∏è **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**

### **Middleware –ø–æ—Ä—è–¥–æ–∫:**
```python
MIDDLEWARE = [
    # ... —ñ–Ω—à—ñ middleware ...
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'playvision.middleware.PhoneRegistrationMiddleware',  # –ü–Ü–°–õ–Ø auth
    'django.contrib.messages.middleware.MessageMiddleware',
    # ... —ñ–Ω—à—ñ middleware ...
]
```

### **Email –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
```bash
# .env
EMAIL_HOST_USER=your-gmail@gmail.com
EMAIL_HOST_PASSWORD=your-16-char-app-password
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
```

---

## üß™ **–¢–µ—Å—Ç–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó**

### **–°—Ü–µ–Ω–∞—Ä—ñ–π 1: Email —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è**
1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ email
2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—à–±–æ—Ä–¥—É - —Å–∏–Ω—î –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è
3. –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∫–æ–¥—É —á–µ—Ä–µ–∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
4. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫–æ–¥—É
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø, –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑–Ω–∏–∫–ª–∏

### **–°—Ü–µ–Ω–∞—Ä—ñ–π 2: Phone —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è**
1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω
2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—à–±–æ—Ä–¥—É - –∂–æ–≤—Ç–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑ –¥–Ω—è–º–∏
3. –î–æ–¥–∞–≤–∞–Ω–Ω—è email —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É
4. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫–æ–¥—É
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø, phone_registered_at = null

### **–°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ó–º—ñ—à–∞–Ω–∏–π**
1. –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ email –±–µ–∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
2. –õ–æ–≥–∞—É—Ç, —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —á–µ—Ä–µ–∑ phone
3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ middleware –Ω–µ –ø–ª—É—Ç–∞—î —Ç–∏–ø–∏
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –∫–æ–∂–µ–Ω —Ç–∏–ø –ø—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ

---

## ‚ú® **–ü–µ—Ä–µ–≤–∞–≥–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó**

- ‚úÖ **–û–¥–∏–Ω –∫–æ–¥** –¥–ª—è –æ–±–æ—Ö —Ç–∏–ø—ñ–≤ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
- ‚úÖ **–ë–µ–∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è** –ª–æ–≥—ñ–∫–∏ —Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤  
- ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è** —ñ—Å–Ω—É—é—á–∏—Ö —Ä—ñ—à–µ–Ω—å
- ‚úÖ **–ë–µ–∑–∫–æ–Ω—Ñ–ª—ñ–∫—Ç–Ω–µ** —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è
- ‚úÖ **–õ–æ–≥—ñ—á–Ω–∏–π UX** - —Ä—ñ–∑–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤
- ‚úÖ **–ë–µ–∑–ø–µ—á–Ω–æ** - middleware –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –Ω–µ-phone –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

---

## üéØ **–ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**

–°–∏—Å—Ç–µ–º–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —ñ –ø—Ä–∞—Ü—é—î –¥–ª—è –æ–±–æ—Ö —Ç–∏–ø—ñ–≤ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º –¥—É–±–ª—é–≤–∞–Ω–Ω—è–º –∫–æ–¥—É —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–º –ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤!
