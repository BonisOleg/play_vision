# üéØ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –ø—ñ–¥–ø–∏—Å–æ–∫ Play Vision

## üìã –ó–º—ñ—Å—Ç
1. [–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π](#–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π)
2. [–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è LiqPay](#–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è-liqpay)
3. [–ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î](#–º—ñ–≥—Ä–∞—Ü—ñ—ó-–±–¥)
4. [–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞–Ω—ñ–≤ –ø—ñ–¥–ø–∏—Å–∫–∏](#—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è-–ø–ª–∞–Ω—ñ–≤-–ø—ñ–¥–ø–∏—Å–∫–∏)
5. [–ê–≤—Ç–æ–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–æ–∫](#–∞–≤—Ç–æ–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è-–ø—ñ–¥–ø–∏—Å–æ–∫)
6. [–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è](#—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

---

## 1Ô∏è‚É£ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
pip3 install -r requirements.txt
```

–û—Å–Ω–æ–≤–Ω—ñ –Ω–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
- `liqpay-sdk-python==1.0.1` - SDK –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ LiqPay API

---

## 2Ô∏è‚É£ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è LiqPay

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è API –∫–ª—é—á—ñ–≤

1. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å –Ω–∞ [liqpay.ua](https://www.liqpay.ua/)
2. –°—Ç–≤–æ—Ä—ñ—Ç—å –º–∞–≥–∞–∑–∏–Ω
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ —Ä–æ–∑–¥—ñ–ª **API** —Ç–∞ —Å–∫–æ–ø—ñ—é–π—Ç–µ:
   - `public_key`
   - `private_key`

### –î–æ–¥–∞–π—Ç–µ –∫–ª—é—á—ñ –≤ `.env`

```env
# LiqPay Settings
LIQPAY_PUBLIC_KEY=your_public_key_here
LIQPAY_PRIVATE_KEY=your_private_key_here
LIQPAY_SANDBOX=True  # False –¥–ª—è production
```

---

## 3Ô∏è‚É£ –ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î

```bash
python3 manage.py migrate subscriptions
```

–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –Ω–æ–≤—ñ –ø–æ–ª—è –¥–ª—è –º–æ–¥–µ–ª—ñ `Plan`:
- `is_best_value` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–π–≤–∏–≥—ñ–¥–Ω—ñ—à–æ–≥–æ –ø–ª–∞–Ω—É
- `badge_type` - —Ç–∏–ø –±–µ–π–¥–∂–∞
- `total_subscriptions` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂—ñ–≤

---

## 4Ô∏è‚É£ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–ª–∞–Ω—ñ–≤ –ø—ñ–¥–ø–∏—Å–∫–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è 4 —Ç–∞—Ä–∏—Ñ—ñ–≤

```bash
python3 manage.py create_subscription_plans
```

–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å:
- **C-VISION** (1 –º—ñ—Å) - 299‚Ç¥
- **B-VISION** (1 –º—ñ—Å) - 599‚Ç¥  
- **A-VISION** (1 –º—ñ—Å) - 999‚Ç¥
- **PRO-VISION** (1 –º—ñ—Å) - 1499‚Ç¥

### –†—É—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–µ—Ä–µ–∑ Django Admin

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ `/admin/subscriptions/plan/`
2. –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –ø–ª–∞–Ω
3. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è:
   - `name` - –Ω–∞–∑–≤–∞ –ø–ª–∞–Ω—É
   - `duration` - —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (1_month / 3_months / 12_months)
   - `duration_months` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—è—Ü—ñ–≤ (—á–∏—Å–ª–æ)
   - `price` - —Ü—ñ–Ω–∞
   - `features` - JSON –º–∞—Å–∏–≤ –ø–µ—Ä–µ–≤–∞–≥
   - `is_popular` - —á–∏ –ø–æ–ø—É–ª—è—Ä–Ω–∏–π –ø–ª–∞–Ω
   - `is_active` - —á–∏ –∞–∫—Ç–∏–≤–Ω–∏–π

---

## 5Ô∏è‚É£ –ê–≤—Ç–æ–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–æ–∫

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è cron job

–î–æ–¥–∞–π—Ç–µ –≤ crontab –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫—É –æ 00:00:

```bash
crontab -e
```

```cron
0 0 * * * cd /path/to/Play_Vision && /path/to/venv/bin/python3 manage.py renew_subscriptions --days-before=3
```

### –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫

```bash
# –¢–µ—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–∏—Ö —Å–ø–∏—Å–∞–Ω—å)
python3 manage.py renew_subscriptions --dry-run

# –†–µ–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫
python3 manage.py renew_subscriptions --days-before=3
```

–ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
- `--days-before N` - –∑–∞ —Å–∫—ñ–ª—å–∫–∏ –¥–Ω—ñ–≤ –¥–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∏ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: 3)
- `--dry-run` - —Ç–µ—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º –±–µ–∑ —Ä–µ–∞–ª—å–Ω–∏—Ö –¥—ñ–π

---

## 6Ô∏è‚É£ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ–ª–æ—É –ø—ñ–¥–ø–∏—Å–∫–∏

1. **–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—ñ–¥–ø–∏—Å–æ–∫:**
   ```
   http://localhost:8000/pricing/
   ```

2. **–û–±–µ—Ä—ñ—Ç—å –ø–ª–∞–Ω** ‚Üí –∫–ª—ñ–∫ –Ω–∞ "–í—Å—Ç—É–ø–∏—Ç–∏ –≤ –∫–ª—É–±" –∞–±–æ "–û–±—Ä–∞—Ç–∏ –ø–ª–∞–Ω"

3. **–°—Ç–æ—Ä—ñ–Ω–∫–∞ checkout:**
   ```
   http://localhost:8000/checkout/<plan_id>/
   ```
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ–ª–µ –ø—Ä–æ–º–æ–∫–æ–¥—É
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–ø–æ—Å–æ–±–∏ –æ–ø–ª–∞—Ç–∏
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –æ–∫—Ä–µ–º–∏–º–∏ –ø–æ–∫—É–ø–∫–∞–º–∏ (—è–∫—â–æ —î)

4. **–¢–µ—Å—Ç–æ–≤–∞ –æ–ø–ª–∞—Ç–∞:**
   - –í —Ä–µ–∂–∏–º—ñ `LIQPAY_SANDBOX=True` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏ LiqPay
   - –¢–µ—Å—Ç–æ–≤–∞ –∫–∞—Ä—Ç–∫–∞: `4242424242424242`, CVV: `123`, –±—É–¥—å-—è–∫–∞ –¥–∞—Ç–∞

5. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:**
   - Success: `http://localhost:8000/payment-success/`
   - Failure: `http://localhost:8000/payment-failure/`

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–¥—ñ—Ä–µ–∫—Ç—ñ–≤

- **–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á** ‚Üí "–í—Å—Ç—É–ø–∏—Ç–∏ –≤ –∫–ª—É–±" ‚Üí –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤–∏–±—Ä–∞–Ω–∏–π –ø–ª–∞–Ω
- **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –±–µ–∑ –ø—ñ–¥–ø–∏—Å–∫–∏** ‚Üí "–û–±—Ä–∞—Ç–∏ –ø–ª–∞–Ω" ‚Üí checkout
- **–ó –∞–∫—Ç–∏–≤–Ω–æ—é –ø—ñ–¥–ø–∏—Å–∫–æ—é** ‚Üí –ø–æ–∫–∞–∑—É—î "–ü–æ—Ç–æ—á–Ω–∏–π –ø–ª–∞–Ω"

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–π–¥–∂—ñ–≤

- **–ù–∞–π–¥–æ–≤—à–∏–π —Ç–µ—Ä–º—ñ–Ω** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º—É—î "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –µ–∫–æ–Ω–æ–º—ñ—è"
- **is_popular=True** ‚Üí "–ù–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π"
- **–ï–∫–æ–Ω–æ–º—ñ—è 15-29%** ‚Üí "–í–∏–≥—ñ–¥–Ω–æ"
- **–ï–∫–æ–Ω–æ–º—ñ—è 30%+** ‚Üí "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –µ–∫–æ–Ω–æ–º—ñ—è"

---

## üé® –ö–∞—Å—Ç–æ–º—ñ–∑–∞—Ü—ñ—è

### –ó–º—ñ–Ω–∞ —Ü—ñ–Ω –ø–ª–∞–Ω—ñ–≤

```python
from apps.subscriptions.models import Plan

plan = Plan.objects.get(name='PRO-VISION')
plan.price = 1999.00
plan.save()
```

### –ó–º—ñ–Ω–∞ –±–µ–π–¥–∂—ñ–≤

```python
plan = Plan.objects.get(name='B-VISION')
plan.is_popular = True
plan.badge_text = "–•—ñ—Ç –ø—Ä–æ–¥–∞–∂—ñ–≤"
plan.save()
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø–µ—Ä–µ–≤–∞–≥

```python
plan = Plan.objects.get(name='PRO-VISION')
plan.features.append('–ù–æ–≤–∞ –ø–µ—Ä–µ–≤–∞–≥–∞')
plan.save()
```

---

## üîß Troubleshooting

### –ü–æ–º–∏–ª–∫–∞ "Module liqpay not found"

```bash
pip3 install liqpay-sdk-python
```

### –ü–æ–º–∏–ª–∫–∞ "Invalid signature" –≤—ñ–¥ LiqPay

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –∫–ª—é—á—ñ–≤ –≤ `.env`:
```bash
echo $LIQPAY_PUBLIC_KEY
echo $LIQPAY_PRIVATE_KEY
```

### –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–µ –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ cron job:
   ```bash
   crontab -l
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:
   ```bash
   tail -f /var/log/cron.log
   ```

3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –≤—Ä—É—á–Ω—É –≤ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ:
   ```bash
   python3 manage.py renew_subscriptions --dry-run
   ```

---

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [LiqPay API Documentation](https://www.liqpay.ua/documentation/api/home)
- [Django Subscriptions Best Practices](https://docs.djangoproject.com/)
- [Play Vision Documentation](./README.md)

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥–ø–∏—Å–æ–∫ –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ —Ç–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.

–î–ª—è production –æ–±–æ–≤'—è–∑–∫–æ–≤–æ:
1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å `LIQPAY_SANDBOX=False` –≤ `.env`
2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ñ API –∫–ª—é—á—ñ
3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ HTTPS
4. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ webhook URL –¥–ª—è LiqPay callbacks
5. –î–æ–¥–∞–π—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–≤—Ç–æ–ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–æ–∫

